a:4:{s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:1:{s:4:"feed";a:1:{i:0;a:6:{s:4:"data";s:147:"

  
  
  
  
  
  
  

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:14:"Anthony Estebe";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:2:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:2:{s:4:"href";s:43:"http://microblog.anthonyestebe.com/atom.xml";s:3:"rel";s:4:"self";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:35:"http://microblog.anthonyestebe.com/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-05-22T12:50:02+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:35:"http://microblog.anthonyestebe.com/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:6:"author";a:1:{i:0;a:6:{s:4:"data";s:13:"
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:2:{s:4:"name";a:1:{i:0;a:5:{s:4:"data";s:14:"Anthony Estebe";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:5:"email";a:1:{i:0;a:5:{s:4:"data";s:25:"contact@anthonyestebe.com";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}s:9:"generator";a:1:{i:0;a:5:{s:4:"data";s:9:"Octopress";s:7:"attribs";a:1:{s:0:"";a:1:{s:3:"uri";s:21:"http://octopress.org/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:5:"entry";a:20:{i:0;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:50:"Compile your SCSS according to your model on Rails";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:97:"http://microblog.anthonyestebe.com/2014-04-28/compile-your-scss-according-to-your-model-on-rails/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-04-28T12:13:44+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:96:"http://microblog.anthonyestebe.com/2014-04-28/compile-your-scss-according-to-your-model-on-rails";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:23612:"<p>I already create some white label products and most of the time there is still the same problem&hellip; customization. It is really hard to match design needs of customers, you can let them upload there logo, change some texts, even provide different templates for a widget for example but one thing hard is to change colors or fonts or stuffs like that. Of course you can provide a service to include their own stylesheet but if you change the css of your widget, all css of your customers have to be tested again and some can not work and moreover you cannot control what they do and if there is a problem even because of them they will call you to say &ldquo;it doesn&rsquo;t work! please, fix it!&rdquo;.</p>

<p>Against this, I wanted to find a clear solution where the customer just set the variables he wants like the main color, the border radius, shadows&hellip; everything you want and you can control. With all of this and thanks to SCSS variable it is possible to customize a CSS.</p>

<!--more-->


<h2>Step 1: Get all variables</h2>

<p>Ok here whatever you want, a model with a has_many variables with key: value, a hash stored, a key database like Redis&hellip; this is up to you, you just need to be able to get all your variables. For this I will have a Mongoid model with just a text field with all variables separated by a \n like that I can edit quickly in a textarea and I just have a function <em>variables</em> to return a hash with all variables extracted.</p>

<h2>Step 2: Inject variables in SCSS</h2>

<p>If you already use some CSS frameworks like <a href="http://getbootstrap.com/">Twitter Bootstrap</a> or <a href="http://foundation.zurb.com/">Foundation</a> for example you can find SASS version where you can override all variables of the framework. We will do the same. Imagine you have a file with all your variables like that.</p>

<figure class='code'><figcaption><span>_variables.css.scss</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="na">$primary-color</span><span class="o">:</span> <span class="nb">red</span><span class="p">;</span>
</span><span class='line'><span class="na">$secondary-color</span><span class="o">:</span> <span class="nb">blue</span><span class="p">;</span>
</span><span class='line'><span class="na">$grid-width</span><span class="o">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>To be able to override some variables you need to append the <em>!default</em> otherwise this variable couldn&rsquo;t be modified (like that you can decide what access you want to give to your customer).</p>

<figure class='code'><figcaption><span>_variables.css.scss</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="na">$primary-color</span><span class="o">:</span> <span class="nb">red</span> <span class="no">default</span><span class="o">!</span><span class="p">;</span> <span class="c1">// customer can change the primary color, if he does nothing the color will be red</span>
</span><span class='line'><span class="na">$secondary-color</span><span class="o">:</span> <span class="nb">blue</span> <span class="no">default</span><span class="o">!</span><span class="p">;</span> <span class="c1">// customer can change the secondary color, if he does nothing the color will be blue</span>
</span><span class='line'><span class="na">$grid-width</span><span class="o">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span> <span class="c1">// this cannot be modified by the customer</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we need to inject those variables in our CSS. Let&rsquo;s create the final CSS which will use the default application template but with variable overwritten. For that we will use a <em>.erb</em> file like that we will be able to write some rails variable in our file. This is pretty simple, just a loop on our variables and then just put the property with the value.</p>

<figure class='code'><figcaption><span>_template.css.scss.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="na">&lt;%</span><span class="err"> </span><span class="na">variables.each</span><span class="err"> </span><span class="na">do</span><span class="err"> </span><span class="na">|property,</span><span class="err"> </span><span class="na">value|</span><span class="err"> </span><span class="na">%&gt;</span>
</span><span class='line'>  <span class="na">$&lt;%</span><span class="err">= </span><span class="na">property</span><span class="err"> </span><span class="na">%&gt;</span><span class="o">:</span> <span class="o">&lt;%=</span> <span class="n">value</span> <span class="o">%&gt;</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">%</span> <span class="nt">end</span> <span class="err">%</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">@</span><span class="nt">import</span> <span class="s2">&quot;the_basic_design_of_my_application&quot;</span><span class="o">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we are, our file can use the application design using some variables defined from the rails application (in a model or whatever you decided).</p>

<h2>Step 3: Compilation</h2>

<p>Ok now the tricky part, we will have to compile the <em>erb</em> to put all variables in our <em>SCSS</em> then compile the <em>SCSS</em> to have our <em>CSS</em> with the variables chosen by the customer.</p>

<p>To compile the erb we will just use the render method from the ActionView::Base class, we will give the list of variables as locals and in our case the template will be &ldquo;template.css&rdquo;.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">compile_erb</span> <span class="n">template</span>
</span><span class='line'>  <span class="ss">ActionView</span><span class="p">:</span><span class="ss">:Base</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">MyApp</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">paths</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">({</span>
</span><span class='line'>    <span class="ss">partial</span><span class="p">:</span> <span class="n">template</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">locals</span><span class="p">:</span> <span class="p">{</span> <span class="ss">variables</span><span class="p">:</span> <span class="n">variables</span> <span class="p">},</span>
</span><span class='line'>    <span class="ss">formats</span><span class="p">:</span> <span class="ss">:scss</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ok then, compile SCSS, this will be almost the same but with a different engine to compile, here we will use Sass::Engine.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">compile_scss</span> <span class="n">template</span>
</span><span class='line'>  <span class="n">sass_engine</span> <span class="o">=</span> <span class="ss">Sass</span><span class="p">:</span><span class="ss">:Engine</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">compile_erb</span><span class="p">(</span><span class="n">template</span><span class="p">),</span> <span class="p">{</span>
</span><span class='line'>    <span class="ss">syntax</span><span class="p">:</span> <span class="ss">:scss</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">style</span><span class="p">:</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">development?</span> <span class="p">?</span> <span class="ss">:nested</span> <span class="p">:</span> <span class="ss">:compressed</span><span class="p">,</span>
</span><span class='line'>    <span class="n">load_paths</span><span class="p">:</span> <span class="ss">MyApp</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">paths</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'>  <span class="n">sass_engine</span><span class="o">.</span><span class="n">render</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ok we are done now you can just call the method <em>compile_scss</em> and you will have your CSS so you can print it in your page ;)</p>

<p>No this is a joke don&rsquo;t do that! we will drop this in a file and even more put this file on s3 using carrierwave.</p>

<h2>Step 4: Save the CSS</h2>

<p>Let&rsquo;s add in our model a column to store the css path and mount this column as uploader.</p>

<figure class='code'><figcaption><span>partner.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Partner</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">Mongoid</span><span class="p">:</span><span class="ss">:Document</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span>   <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:css</span><span class="p">,</span>    <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:config</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="s2">&quot;primary-color: black&quot;</span>
</span><span class='line'>  <span class="n">mount_uploader</span> <span class="ss">:css</span><span class="p">,</span> <span class="no">CssUploader</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;template.css&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kp">private</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">variables</span>
</span><span class='line'>    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>    <span class="n">list</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">list</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span> <span class="s2">&quot;:&quot;</span>
</span><span class='line'>      <span class="n">res</span><span class="o">[</span><span class="nb">split</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">strip</span><span class="o">]</span> <span class="o">=</span> <span class="nb">split</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">strip</span> <span class="k">if</span> <span class="nb">split</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">2</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">res</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">compile_erb</span>
</span><span class='line'>    <span class="ss">ActionView</span><span class="p">:</span><span class="ss">:Base</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">MyApp</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">paths</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">({</span>
</span><span class='line'>      <span class="ss">partial</span><span class="p">:</span> <span class="ss">Partner</span><span class="p">:</span><span class="ss">:TEMPLATE</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">locals</span><span class="p">:</span> <span class="p">{</span> <span class="ss">variables</span><span class="p">:</span> <span class="n">variables</span> <span class="p">},</span>
</span><span class='line'>      <span class="ss">formats</span><span class="p">:</span> <span class="ss">:scss</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">compile_scss</span>
</span><span class='line'>    <span class="n">sass_engine</span> <span class="o">=</span> <span class="ss">Sass</span><span class="p">:</span><span class="ss">:Engine</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">compile_erb</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>      <span class="ss">syntax</span><span class="p">:</span> <span class="ss">:scss</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">style</span><span class="p">:</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">development?</span> <span class="p">?</span> <span class="ss">:nested</span> <span class="p">:</span> <span class="ss">:compressed</span><span class="p">,</span>
</span><span class='line'>      <span class="n">load_paths</span><span class="p">:</span> <span class="ss">MyApp</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">paths</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>    <span class="n">sass_engine</span><span class="o">.</span><span class="n">render</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>For the uploader I let you have a look at <a href="https://github.com/carrierwaveuploader/carrierwave">carrierwave gem</a>.</p>

<p>So now let&rsquo;s trigger the compilation of our CSS and save it in our uploader everytime we change some variables</p>

<figure class='code'><figcaption><span>partner.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Partner</span>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'>  <span class="n">before_save</span> <span class="ss">:compile_css</span>
</span><span class='line'>
</span><span class='line'><span class="kp">private</span>
</span><span class='line'>  <span class="c1">#...</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">compile_css</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">if</span> <span class="n">config_changed?</span> <span class="o">&amp;&amp;</span> <span class="n">css</span><span class="o">.</span><span class="n">present?</span>
</span><span class='line'>    <span class="nb">require</span> <span class="s1">&#39;tempfile&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">file</span> <span class="o">=</span> <span class="no">Tempfile</span><span class="o">.</span><span class="n">open</span> <span class="o">[</span><span class="nb">name</span><span class="p">,</span> <span class="s2">&quot;.css&quot;</span><span class="o">]</span>
</span><span class='line'>    <span class="k">begin</span>
</span><span class='line'>      <span class="n">file</span><span class="o">.</span><span class="n">write</span> <span class="n">compile_scss</span>
</span><span class='line'>      <span class="n">file</span><span class="o">.</span><span class="n">flush</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">css</span> <span class="o">=</span> <span class="n">file</span>
</span><span class='line'>    <span class="k">ensure</span>
</span><span class='line'>      <span class="n">file</span><span class="o">.</span><span class="n">close</span>
</span><span class='line'>      <span class="n">file</span><span class="o">.</span><span class="n">unlink</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it, now everytime you will change your variables, the new CSS will be compiled and then save using carrierwave</p>

<h2>Step 5: Add it to your DOM</h2>

<p>This is the final step, really easy, just in your HTML now you can simply add your partner CSS like that</p>

<figure class='code'><figcaption><span>application.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>  <span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>%= stylesheet_link_tag @partner.css if @partner %&gt;
</span><span class='line'>  <span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s all !! This post is a bit long and some part a bit complex but this can be really useful in some case, especially when you work on some products where you want to let people customize their design. For now it&rsquo;s the best solution I found if anyone have another I would be happy to ear it :)</p>

<p>PS: This technique was inspired by the excellent <a href="http://getbootstrap.com/customize/">Twitter bootstrap customization</a> and now it&rsquo;s possible to do the same ;)</p>

<h2>Update</h2>

<p>If you are using Compass, you will have some problems in production. The solution is pretty simple you just have to include by yourself the paths of compass.
<code>compass_paths = Compass.sass_engine_options[:load_paths].collect { |path| path.try(:root) }.compact</code>
with this on the compile_scss function you just have to add those paths <code>load_paths: MyApp::Application.assets.paths + compass_paths</code>. That&rsquo;s it now you can use compass even in production without problems ;)</p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:1;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:16:"Bower with Rails";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:63:"http://microblog.anthonyestebe.com/2014-03-24/bower-with-rails/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-03-24T10:09:29+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:62:"http://microblog.anthonyestebe.com/2014-03-24/bower-with-rails";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:3570:"<p>Today, after a long time without posting I will show you how to integrate bower in a Rails application. Many times I was a bit frustrated when I found a nice lib I want to include in a project but when I want to find the associated gem, sometimes the lib is not up to date inside and I have to wait for the new version of the gem&hellip; Another solution is to download the version of the lib you want and put it in the vendor directory but in that case it can be really boring to maintain&hellip;</p>

<p>Now there is a solution for that thanks to <a href="http://microblog.anthonyestebe.com/2014-01-23/what-is-yeoman-part-2-bower">Bower</a>.</p>

<!-- more -->


<p>First step, you have to add the gem <em><a href="https://github.com/42dev/bower-rails">bower-rails</a></em> in your Gemfile then the classic <code>bundle</code> and finish with <code>rails g bower_rails:initialize</code>.</p>

<p>Now you can have a look on your new file in your initializers directory.</p>

<figure class='code'><figcaption><span>config/initializers/bower_rails.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">asset</span> <span class="s1">&#39;angular&#39;</span>
</span><span class='line'><span class="n">asset</span> <span class="s1">&#39;angular-resource&#39;</span>
</span><span class='line'><span class="n">asset</span> <span class="s1">&#39;angular-route&#39;</span>
</span><span class='line'><span class="n">asset</span> <span class="s1">&#39;requirejs&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is an exemple with angular and requirejs loaded. Then you just need to run the command <code>rake bower:install</code> and your bower.json file will be created/updated and your libs downloaded in your vendor directory. Of course you can set a specific version, change the destination directory etc&hellip; I&rsquo;m sure you will have a look on the <a href="https://github.com/42dev/bower-rails">doc</a> if you want more details.</p>

<p>Now because the vendor path is in the assets path of rails you can simply include your files in your application.js file (also your stylesheets).</p>

<figure class='code'><figcaption><span>application.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//= require_self</span>
</span><span class='line'><span class="c1">//= require angular</span>
</span><span class='line'><span class="c1">//= require angular-resource</span>
</span><span class='line'><span class="c1">//= require angular-route</span>
</span><span class='line'><span class="c1">//= require requirejs</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it ! So now you can remove all the gems you have for different lib you use like your twitter-bootstrap, zurb-foundation, backbone, angular&hellip; and just load everything using bower. Maybe the next step will be to use <a href="http://microblog.anthonyestebe.com/2014-01-25/what-is-yeoman-part-3-grunt">Grunt</a> instead of sprockets for my asset pipeline.</p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:2;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:24:"From Backbone to Angular";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:71:"http://microblog.anthonyestebe.com/2014-02-28/from-backbone-to-angular/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-02-28T12:47:07+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:70:"http://microblog.anthonyestebe.com/2014-02-28/from-backbone-to-angular";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:5551:"<p>Recently I worked on a migration from Backbone to Angular for a customer, I wrote the Backbone code about one year ago and it started to be hard to maintains so I decided to migrate to Angular to have something easier to improve when this customer will change the front end or add some new features. I was really curious to see the impact of a migration like that (I mean for maintainability more than speed or whatever).</p>

<!-- more -->


<p>I just finish this migration few days ago and so I wanted to share some statistics I computed to see the before/after. Of course this is not really objective because the Backbone code was a bit crappy after adding some feature then change then change again&hellip; but honestly, I really don&rsquo;t like shit code so I did some refactoring on it many times. One of the other reason why those statistics may be &ldquo;wrong&rdquo; is because I made different choice for libraries I used. I changed one library to load a WISIWIG (before ckeditor, now text-angular) and one other to display statistics (before highchart, now ng-google-chart) I decided also to not use some library like the ones from Bootstrap or isotope because it can be done easily with Angular.</p>

<p>Another thing to keep in mind, I did those statistics using my resources not minifies or gziped, just pure js from my coffee files so don&rsquo;t be afraid to see so many files ;)</p>

<p>Now this is clear, let&rsquo;s have a look on those statistics:</p>

<ul>
<li><span style="background-color: lightgreen;">green</span> benefits >= 50%</li>
<li><span style="background-color: gold;">yellow</span> benefits between 40 and 50%</li>
<li><span style="background-color: darksalmon;">orange</span> benefits between 30 and 40%</li>
<li><span style="background-color: crimson;">red</span> benefits &lt; 30%</li>
</ul>


<table>
  <thead>
    <tr>
      <th></th>
      <th>Backbone</th>
      <th>Angular</th>
      <th>+/-</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Number of javascript files loaded</td>
      <td>140</td>
      <td>59</td>
      <td style="background-color: lightgreen;">-58%</td>
    </tr>
    <tr>
      <td>Number of libraries loaded</td>
      <td>10 <small>(jquery, backbone, underscore, isotope, ckeditor, twitter bootstrap, backbone formdata, highchart, i18n)</small></td>
      <td>7 <small>(angular, angular-route, angular-resource, 
angular-sanitize, angular-file-upload, ng-google-chart, text-angular)</small></td>
      <td style="background-color: darksalmon;">-30%</td>
    </tr>
    <tr>
      <td>Total size loaded (not minified, not gziped)</td>
      <td>1610.4K</td>
      <td>901.6K</td>
      <td style="background-color: gold;">-44%</td>
    </tr>
    <tr>
      <td>Size of libraries</td>
      <td>1410.75K</td>
      <td>838.9K</td>
      <td style="background-color: gold;">-41%</td>
    </tr>
    <tr>
      <td>Code I wrote</td>
      <td>200.85K</td>
      <td>62.6K</td>
      <td style="background-color: lightgreen;">-69%</td>
    </tr>
    <tr>
      <td>Number of Coffee files</td>
      <td>72</td>
      <td>46</td>
      <td style="background-color: darksalmon;">-36%</td>
    </tr>
    <tr>
      <td>Line of code (CoffeeScript)</td>
      <td>1907</td>
      <td>853</td>
      <td style="background-color: lightgreen;">-55%</td>
    </tr>
    <tr>
      <td>Lines by scripts</td>
      <td>26.48</td>
      <td>15.23</td>
      <td style="background-color: gold;">-42%</td>
    </tr>
    <tr>
      <td>Number of template files</td>
      <td>40</td>
      <td>23</td>
      <td style="background-color: gold;">-43%</td>
    </tr>
    <tr>
      <td>Line of code (templates)</td>
      <td>745</td>
      <td>861</td>
      <td style="background-color: crimson;">+15%</td>
    </tr>
  </tbody>
</table>


<p>I was a bit surprise to see so much differences, I was thinking because Angular is a lot more heavier than backbone (727.5K vs 57K) the total weight will be at least almost the same but finally we almost divide by 2 the weight of the application because Backbone needs many other things, like juste jquery and underscore wich are required, angular is built in with everything and don&rsquo;t need anything else. Moreover we can see the number of files, of lines in those files and in general the number of line of code to maintains is reduced a lot (divided by 2). <small><em>This is great for me, less work to do :)</em></small>.</p>

<p>So now to resume, I spend few days to rewrite all the application but now I have something faster to load and really faster to maintain and improve. This prove again that Angular is just awesome and out of the box is just hundreds time more efficient than Backbone and even is heavier than Backbone, at the end this is not a big problem because you will not need to include really big plugins.</p>

<p>Maybe in another post I will add some statistics about loading, rendering, memory etc&hellip; using Chrome performances tools (which will be another post too ;)) and we will see if the double binding of Angular is not too slow or if the rendering is faster (I think I already know the answers). So see you in a next post and I hope this feedback can be helpful for some poeple.</p>

<p><em>PS: I would be happy to know some static code analysis tools because for now I just used <a href="http://cloc.sourceforge.net/">cloc</a> and some command lines but I didn&rsquo;t find any good cyclomatic complexity tool for exemple for coffee or even generic tools so if you know I would apreciate your feedbacks :)</em></p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:3;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:43:"Show compiled source of Coffee in Octopress";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:90:"http://microblog.anthonyestebe.com/2014-02-22/show-compiled-source-of-coffee-in-octopress/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-02-22T12:11:45+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:89:"http://microblog.anthonyestebe.com/2014-02-22/show-compiled-source-of-coffee-in-octopress";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:25981:"<p>Every time I wrote some Javascript I use Coffeescript for those posts (and most of the time for dev also). The problem is, some people don&rsquo;t know Coffee and don&rsquo;t want to use it for good or bad reasons, this doesn&rsquo;t matter. So I wanted to offer the possibility in this blog to switch between coffeescript and javascript files.</p>

<p>This blog is written with <a href="http://octopress.org/">Octopress</a> and with it you can write or modify some plugins. My goal now is to modify the plugin which convert my code block (using &#96;&#96;&#96;&hellip;&#96;&#96;&#96;) from markdown to a pretty block with colors and everything and then modify it to add another block with the javascript compiled from coffee.</p>

<!-- more -->


<p>First we need to find this plugin&hellip; all the plugins are located in <em>/plugins</em> and then you will find one called <strong>backtick_code_block.rb</strong>.</p>

<p>This plugin contains one function <em>render_code_block</em>, this one is called on each page and will replace all content matching &#96;&#96;&#96;&hellip;&#96;&#96;&#96; with the block code. So in this function I will add another block when the language used is <em>coffeescript</em> and I will create a function to convert the coffee into javascript using coffee compiler.</p>

<figure class='code'><figcaption><span>backtick_code_block.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">def</span> <span class="nf">render_code_block</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="n">input</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/^`{3} *([^\n]+)?\n(.+?)\n`{3}/m</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">if</span> <span class="vi">@lang</span><span class="o">.</span><span class="n">nil?</span> <span class="o">||</span> <span class="vi">@lang</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="k">if</span> <span class="vi">@lang</span><span class="o">.</span><span class="n">include?</span> <span class="s2">&quot;-raw&quot;</span>
</span><span class='line'>        <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="n">code</span> <span class="o">=</span> <span class="n">highlight</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="vi">@lang</span><span class="p">)</span>
</span><span class='line'>        <span class="s2">&quot;&lt;figure class=&#39;code&#39;&gt;</span><span class="si">#{</span><span class="vi">@caption</span><span class="si">}#{</span><span class="n">code</span><span class="si">}</span><span class="s2">&lt;/figure&gt;&quot;</span>
</span><span class='line'>        <span class="c1"># here will come the code to add the new block</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>But first we will create this function to convert our coffee in js and to be mode generic I will store this in an object which will contains all converters (later we will be able to add converter for sass, less, typescript&hellip;).</p>

<figure class='code'><figcaption><span>backtick_code_block.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">BacktickCodeBlock</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="no">CharToEscapeToConvert</span> <span class="o">=</span> <span class="sr">/([$&quot;])/</span>
</span><span class='line'>  <span class="no">Converter</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="ss">coffeescript</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="ss">command</span><span class="p">:</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">escaped_code</span><span class="o">|</span> <span class="sb">`coffee --eval --print --bare &quot;</span><span class="si">#{</span><span class="n">escaped_code</span><span class="si">}</span><span class="sb">&quot;`</span> <span class="p">},</span>
</span><span class='line'>      <span class="ss">destination</span><span class="p">:</span> <span class="s2">&quot;javascript&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">extension_in</span><span class="p">:</span> <span class="s2">&quot;coffee&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">extension_out</span><span class="p">:</span> <span class="s2">&quot;js&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">convert</span> <span class="n">converter</span><span class="p">,</span> <span class="n">code</span>
</span><span class='line'>    <span class="n">escaped_code</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="no">CharToEscapeToConvert</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">match</span><span class="o">|</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="si">#{</span><span class="n">match</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">converter</span><span class="o">[</span><span class="ss">:command</span><span class="o">].</span><span class="n">call</span> <span class="n">escaped_code</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;/!</span><span class="se">\\</span><span class="s2"> error while converting to </span><span class="si">#{</span><span class="n">converter</span><span class="o">[</span><span class="ss">:destination</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">e</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>CharToEscapeToConvert</strong> represent the list of character I should escape to be able to execute with shell command.</li>
<li><strong>Converter</strong> is my object with all converters (for now only coffeescript to javascript). It contains the command to execute, the destination language and the extensions in input and in output</li>
<li><strong>convert</strong> function will just escape one code and convert it using a converter given in parameter</li>
</ul>


<p>So now we have our function to convert coffee into javascript we just need to update the code to display the code block.</p>

<figure class='code'><figcaption><span>backtick_code_block.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">def</span> <span class="nf">render_code_block</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="n">input</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/^`{3} *([^\n]+)?\n(.+?)\n`{3}/m</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">if</span> <span class="vi">@lang</span><span class="o">.</span><span class="n">nil?</span> <span class="o">||</span> <span class="vi">@lang</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="k">if</span> <span class="vi">@lang</span><span class="o">.</span><span class="n">include?</span> <span class="s2">&quot;-raw&quot;</span>
</span><span class='line'>        <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="n">code</span> <span class="o">=</span> <span class="n">highlight</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="vi">@lang</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&lt;figure class=&#39;code&#39;&gt;</span><span class="si">#{</span><span class="vi">@caption</span><span class="si">}#{</span><span class="n">code</span><span class="si">}</span><span class="s2">&lt;/figure&gt;&quot;</span>
</span><span class='line'>        <span class="n">converter</span> <span class="o">=</span> <span class="no">Converter</span><span class="o">[</span><span class="vi">@lang</span><span class="o">.</span><span class="n">to_sym</span><span class="o">]</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">converter</span>
</span><span class='line'>          <span class="n">converted_code</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">converter</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span>
</span><span class='line'>          <span class="k">if</span> <span class="n">converted_code</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">converted_code</span><span class="o">.</span><span class="n">empty?</span>
</span><span class='line'>            <span class="n">converted_code</span> <span class="o">=</span> <span class="n">highlight</span><span class="p">(</span><span class="n">converted_code</span><span class="p">,</span> <span class="n">converter</span><span class="o">[</span><span class="ss">:destination</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>            <span class="n">caption</span> <span class="o">=</span> <span class="vi">@caption</span><span class="o">.</span><span class="n">gsub</span> <span class="n">converter</span><span class="o">[</span><span class="ss">:extension_in</span><span class="o">]</span><span class="p">,</span> <span class="n">converter</span><span class="o">[</span><span class="ss">:extension_out</span><span class="o">]</span>
</span><span class='line'>            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;div&gt;</span>
</span><span class='line'><span class="s2">              </span><span class="si">#{</span><span class="n">result</span><span class="si">}</span><span class="s2"></span>
</span><span class='line'><span class="s2">              &lt;figure class=&#39;code hide&#39;&gt;</span><span class="si">#{</span><span class="n">caption</span><span class="si">}#{</span><span class="n">converted_code</span><span class="si">}</span><span class="s2">&lt;/figure&gt;</span>
</span><span class='line'><span class="s2">              &lt;a href=&#39;#&#39; class=&#39;toggle-code&#39;&gt;Toggle </span><span class="si">#{</span><span class="vi">@lang</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">converter</span><span class="o">[</span><span class="ss">:destination</span><span class="o">]</span><span class="si">}</span><span class="s2">&lt;/a&gt;</span>
</span><span class='line'><span class="s2">            &lt;/div&gt;&quot;&quot;&quot;</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>        <span class="n">result</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>We try to find a converter for this language and if we found, we convert the code then highlight it (this function will create the pretty block code) and then wrap everything in a div and add a link to switch the view. We add also the class &ldquo;hide&rdquo; to display only one block code.</p>

<p>Almost done, now when you compile your files you will be able to see your code coffee and js so we just need to implement the toggle now.</p>

<p>First, add the &ldquo;hide&rdquo; class</p>

<figure class='code'><figcaption><span>screen.scss</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="nc">.hide</span> <span class="p">{</span> <span class="na">display</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>then create a new js script</p>

<div>
                <figure class='code'><figcaption><span>source/javascripts/code-toggle.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">clickFunction = </span><span class="nf">(event) -&gt;</span>
</span><span class='line'>    <span class="k">for</span> <span class="nx">child</span> <span class="k">in</span> <span class="nx">@parentElement</span><span class="p">.</span><span class="nx">children</span> <span class="k">when</span> <span class="nx">child</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">is</span> <span class="s">&quot;FIGURE&quot;</span>
</span><span class='line'>      <span class="nx">child</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span> <span class="s">&quot;hide&quot;</span>
</span><span class='line'>    <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span>
</span><span class='line'>      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="nv">event.returnValue = </span><span class="kc">false</span>
</span><span class='line'>  <span class="k">for</span> <span class="nx">element</span> <span class="k">in</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span> <span class="s">&quot;toggle-code&quot;</span>
</span><span class='line'>    <span class="nv">element.onclick = </span><span class="nx">clickFunction</span>
</span><span class='line'>  <span class="k">return</span>
</span><span class='line'><span class="p">)()</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span>source/javascripts/code-toggle.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">clickFunction</span><span class="p">,</span> <span class="nx">element</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">clickFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">_ref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">child</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">===</span> <span class="s2">&quot;FIGURE&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">child</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="s2">&quot;hide&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">event</span><span class="p">.</span><span class="nx">returnValue</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="nx">_ref</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">&quot;toggle-code&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">element</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
</span><span class='line'>    <span class="nx">element</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="nx">clickFunction</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>Last step include your script in <em>source/_includes/after_footer.html</em> and everything is done.</p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:4;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:32:"Google analytics for your emails";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:79:"http://microblog.anthonyestebe.com/2014-02-10/google-analytics-for-your-emails/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-02-10T20:36:01+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:78:"http://microblog.anthonyestebe.com/2014-02-10/google-analytics-for-your-emails";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:4450:"<p>Last time I was talking about <a href="http://microblog.anthonyestebe.com/2014-02-04/fetch-your-google-analytics-data-using-rails">Google Analytics in your rails app</a>. Today I will continue with Google Analytics but this time in your emails.</p>

<p>This is a small hack but it can be really useful. As you probably know, with a classic email, you cannot know if the receiver open the email you just sent but when you use some services like <a href="http://mailchimp.com/">Mailchimp</a> or <a href="http://sendgrid.com/">Sendgrid</a>, you can have those statistics. So today we will do like Sendgrid and Mailchimp but using Google Analytics.</p>

<p>I will not talk too much, here is directly the trick to log when people open your email.</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;http://www.google-analytics.com/collect?v=1&amp;tid=UA-XXXXXXXX&amp;cid=CLIENT_ID&amp;t=event&amp;ec=email&amp;ea=open&amp;el=MY_LABEL&amp;cs=newsletter&amp;cm=email&amp;cn=MY_LABEL&amp;cm1=1&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let explain a bit.</p>

<p><a href="http://www.google-analytics.com/collect">http://www.google-analytics.com/collect</a> :
This is the API for google analytics to send some data. You can send almost all the data you want. It takes many parameters:</p>

<p><strong>required parameters:</strong></p>

<ul>
<li><em>v</em>: version of the API for now this parameter value is 1</li>
<li><em>tid</em>: the profile id of your website (ie: UA-XXXXXXXX-XX)</li>
<li><em>cid</em>: client id</li>
<li><em>t</em>: the kind of data you want to send. In our case an <em>event</em></li>
</ul>


<p><strong>optional parameters: </strong></p>

<ul>
<li><em>ec</em>: the category of the data. In our case <em>email</em></li>
<li><em>ea</em>: the action relative to your data. In our case <em>open</em></li>
<li><em>el</em>: the label of your data for example the name of your campaign. This will be helpful to identify your data in Google Analytics</li>
<li><em>cs</em>: campaign source. In our case this is a newsletter</li>
<li><em>cm</em>: campaign medium. In our case this is an email</li>
<li><em>cn</em>: campaign name. You can put the same value ad <strong>el</strong></li>
<li><em>cm1</em>: custom metric. You can just set 1, like that easily create some custom variables in Google Analytics with 0 or 1 value.</li>
</ul>


<p>In our case for the email we want to send a new <strong>event</strong> <strong>open</strong> in the category <strong>email</strong> with the <strong>label</strong> you want.</p>

<p><strong>How does it works</strong></p>

<p>When the email client (web or application) will load the email it will try to download the image because we wrap this API call in an IMG tag and every src in IMG tag will be called by the GET method which is exactly what Google needs for this API. So when the email client will load the picture, in fact it will execute one GET request to send some data in your analytics and so, now, you can even see in the real-time view of your Google Analytics people who open this email and because you set campaign parameters you can also see in the Acquisition/Campaigns tab all your campaigns. And, even with the previous post about <a href="http://microblog.anthonyestebe.com/2014-02-04/fetch-your-google-analytics-data-using-rails">fetching google analytics data</a> you can easily display some graphs with the statistics of your campaign using some filters on your campaign ;)</p>

<blockquote><p><strong>personal thinking</strong> : This trick of an API call using an IMG tag is really nice but to be honest I&rsquo;m not sure this will be possible in the next years because the behavior is not the one expected and in general you can do some bad things with IMG tags like download some scripts instead of pictures, you can also inject some code so I think IMG have to be rethink and it&rsquo;s good we have to rethink about it also for responsive pictures.</p>

<p>To finish this hack will perhaps not works in many years but until this moment it&rsquo;s a really simple hack and it can be very helpful ;)</p></blockquote>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:5;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:44:"Fetch your Google Analytics data using Rails";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:91:"http://microblog.anthonyestebe.com/2014-02-04/fetch-your-google-analytics-data-using-rails/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-02-04T18:58:36+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:90:"http://microblog.anthonyestebe.com/2014-02-04/fetch-your-google-analytics-data-using-rails";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:17771:"<p>Today we will see how to collect your data from Google Analytics. Everyone use it, I&rsquo;m sure, but sometime, for many different reasons, you can have to collect those data using the API provided by google. Of course with rails most of the time you can find a gem to do that and for Google Analytics API you have <a href="http://github.com/Sija/garb">garb</a>.</p>

<p>This gem allows you to connect to your google account (or the one of your customer) and then fetch all the information you need.</p>

<p>In theory it&rsquo;s not so complicated, but in practice if you want to provide a real analytics engine, this gem in not so convenient.</p>

<p>Let&rsquo;s see how to implement it in a basic way first. Let&rsquo;s say I just want all the time the same metrics, the number of visits per day during the last month.</p>

<!-- more -->


<p>First step connect and fetch the google profile you need (the one with UA-XXXXXXXX-XX).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">get_profile</span> <span class="n">ga_ua</span>
</span><span class='line'>  <span class="ss">Garb</span><span class="p">:</span><span class="ss">:Session</span><span class="o">.</span><span class="n">login</span> <span class="no">MY_ACCOUNT</span><span class="p">,</span> <span class="no">MY_ACCOUNT_PWD</span>
</span><span class='line'>  <span class="ss">Garb</span><span class="p">:</span><span class="ss">:Management</span><span class="o">::</span><span class="no">Profile</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">find</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="nb">p</span><span class="o">.</span><span class="n">web_property_id</span> <span class="o">==</span> <span class="n">ga_ua</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Second step create the report you want</p>

<figure class='code'><figcaption><span>app/reports/visits.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Report</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Visits</span> <span class="o">&lt;</span> <span class="ss">Garb</span><span class="p">:</span><span class="ss">:Model</span>
</span><span class='line'>    <span class="n">metrics</span> <span class="ss">:visits</span>
</span><span class='line'>    <span class="n">dimension</span> <span class="ss">:date</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then fetch the results</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Report</span><span class="p">:</span><span class="ss">:Visits</span><span class="o">.</span><span class="n">result</span> <span class="n">get_profile</span><span class="p">(</span><span class="s2">&quot;UA-XXXXXXXX-XX&quot;</span><span class="p">),</span> <span class="n">start_date</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">ago</span><span class="o">.</span><span class="n">to_date</span>
</span></code></pre></td></tr></table></div></figure>


<p>So this is not so bad but let&rsquo;s say you want to have a report now with the number of new visitors per days, then also per month, the visits per hours and just even let the user select the metric, the dimension and even some filter (s)he want. You will not be able to write a report for everything so let&rsquo;s adapt this to create a dynamic report.</p>

<h2>A generic report</h2>

<p>First you need to add the reset function in <strong>ReportParameter</strong> (this class manage a list of elements which can be your metrics or your dimensions).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Garb</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">ReportParameter</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">reset</span> <span class="n">elements</span><span class="o">=[]</span>
</span><span class='line'>      <span class="vi">@elements</span> <span class="o">=</span> <span class="n">elements</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>When this is done, you can remove all your reports files and write only one.</p>

<figure class='code'><figcaption><span>app/reports/report.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Report</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Generic</span> <span class="o">&lt;</span> <span class="ss">Garb</span><span class="p">:</span><span class="ss">:Model</span><span class="p">;</span> <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And now start the &ldquo;tricky&rdquo; part. Instead of just <code>Report::Visits.result()</code> we will have to create a report and add the metrics and dimensions just like that.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">create_report</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">dimensions</span>
</span><span class='line'>  <span class="n">report</span> <span class="o">=</span> <span class="ss">Report</span><span class="p">:</span><span class="ss">:Generic</span>
</span><span class='line'>  <span class="n">report</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">reset</span> <span class="n">metrics</span>
</span><span class='line'>  <span class="n">report</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">reset</span> <span class="n">dimensions</span>
</span><span class='line'>  <span class="n">report</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once this is done you can fetch your result like before</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">report</span> <span class="o">=</span> <span class="n">create_report</span> <span class="o">[</span><span class="ss">:visits</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="ss">:date</span><span class="o">]</span>
</span><span class='line'><span class="n">report</span><span class="o">.</span><span class="n">result</span> <span class="n">get_profile</span><span class="p">(</span><span class="s2">&quot;UA-XXXXXXXX-XX&quot;</span><span class="p">),</span> <span class="n">start_date</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">ago</span><span class="o">.</span><span class="n">to_date</span>
</span></code></pre></td></tr></table></div></figure>


<p>For filters you need to give it on the result function like that</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">report</span><span class="o">.</span><span class="n">result</span> <span class="n">get_profile</span><span class="p">(</span><span class="s2">&quot;UA-XXXXXXXX-XX&quot;</span><span class="p">),</span> <span class="n">start_date</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">ago</span><span class="o">.</span><span class="n">to_date</span><span class="p">,</span> <span class="ss">filter</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>  <span class="ss">:campaign</span><span class="o">.</span><span class="n">contains</span> <span class="o">=&gt;</span> <span class="s2">&quot;whatever_you_want&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Of course this is not really convenient if you want to let the user choose its own filter because you need to play with some symbols but with a small function you can convert all.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># filter parameter should be like that</span>
</span><span class='line'><span class="c1">#   { campaign: { contains: &quot;what_you_want&quot; } }</span>
</span><span class='line'><span class="c1"># if you have multiple value only the first one will be taken</span>
</span><span class='line'><span class="c1">#   { campaign: { contains: &quot;what_you_want&quot;, substring: &quot;blabla&quot; }, visits: { gt: 20 } }</span>
</span><span class='line'><span class="c1">#   will generate</span>
</span><span class='line'><span class="c1">#   { :campaign.contains =&gt; &quot;what_you_want&quot; }</span>
</span><span class='line'><span class="c1"># have a list of all filters on lib/garb/core_ext/symbol.rb</span>
</span><span class='line'><span class="k">def</span> <span class="nf">convert_filter</span> <span class="n">filter</span><span class="o">=</span><span class="p">{}</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">if</span> <span class="n">filter</span><span class="o">.</span><span class="n">empty?</span>
</span><span class='line'>  <span class="n">filter_name</span> <span class="o">=</span> <span class="n">filter</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">to_sym</span>
</span><span class='line'>  <span class="n">comparator</span> <span class="o">=</span> <span class="n">filter</span><span class="o">[</span><span class="n">filter_name</span><span class="o">].</span><span class="n">keys</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">to_sym</span>
</span><span class='line'>  <span class="p">{</span> <span class="n">filter_name</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">comparator</span><span class="p">)</span><span class="o">.</span><span class="n">call</span> <span class="o">=&gt;</span> <span class="n">filter</span><span class="o">[</span><span class="n">filter_name</span><span class="o">][</span><span class="n">comparator</span><span class="o">]</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>(you can see some meta-programming with <code>method(comparator).call</code> this will call the method which have the name of the value of comparator)</em></p>

<p>Now you can simply create a controller to give all your parameters and then just create the report you want.</p>

<figure class='code'><figcaption><span>report_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>    <span class="n">report</span> <span class="o">=</span> <span class="n">create_report</span> <span class="n">params</span><span class="o">[</span><span class="ss">:metrics</span><span class="o">]</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:dimensions</span><span class="o">]</span>
</span><span class='line'>    <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="n">report</span><span class="o">.</span><span class="n">result</span> <span class="n">get_profile</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:ga_ua</span><span class="o">]</span><span class="p">),</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">start_date</span><span class="p">:</span> <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">param</span><span class="o">[</span><span class="ss">:start_date</span><span class="o">]</span> <span class="o">||</span> <span class="mi">1</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">ago</span><span class="o">.</span><span class="n">to_date</span><span class="o">.</span><span class="n">to_s</span><span class="p">),</span>
</span><span class='line'>      <span class="n">end_date</span><span class="p">:</span> <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">param</span><span class="o">[</span><span class="ss">:start_date</span><span class="o">]</span> <span class="o">||</span> <span class="no">Date</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">to_s</span><span class="p">),</span>
</span><span class='line'>      <span class="ss">filter</span><span class="p">:</span> <span class="n">convert_filter</span> <span class="n">params</span><span class="o">[</span><span class="ss">:filter</span><span class="o">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now you can create a nice UI to display all possible metrics and you can do your clone of Google Analytics (or maybe not&hellip;). You will see the API is not really fast so you will need to use a lot of cache or display a <a href="http://microblog.anthonyestebe.com/2013-12-04/automatic-loader-with-ajax-call-on-angular">nice loader</a> for your user ;)</p>

<p><em>Note:</em> Of course you can write your report(s) as a model but personally I prefer to create a folder for that and then load it in my config/application.rb with <code>config.autoload_paths += %W(#{config.root}/app/reports)</code></p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:6;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:16:"Watch with Grunt";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:63:"http://microblog.anthonyestebe.com/2014-01-27/watch-with-grunt/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-01-27T16:18:14+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:62:"http://microblog.anthonyestebe.com/2014-01-27/watch-with-grunt";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:10636:"<p>The <a href="http://microblog.anthonyestebe.com/2014-01-25/what-is-yeoman-part-3-grunt">last post</a> was talking about <em>Grunt</em> and how to add all your <em>bower</em> dependencies in your index file. Today we will see how to do that, still using <em>Grunt</em>, but this time <em>Grunt</em> will do everything, we will not have to run the command all the time.</p>

<p>The goal here is to detect when the <strong>bower.json</strong> file is updated and when it&rsquo;s the case, run the task <strong>bower-install</strong> to inject all dependencies in your html and in bonus to automatically refresh your browser using <a href="http://livereload.com/">livereload</a>.</p>

<!-- more -->


<p>First, we need to install a plugin (grunt-contrib-watch) to be able to watch files <code>npm install grunt-contrib-watch --save-dev</code>.</p>

<p>Second, we need to configure this plugin to watch our <strong>bower.json</strong> file</p>

<div>
                <figure class='code'><figcaption><span>Gruntfile.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="s">&#39;use strict&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">module.exports = </span><span class="nf">(grunt) -&gt;</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-bower-install&#39;</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-contrib-watch&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span>
</span><span class='line'>    <span class="nv">pkg: </span><span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span> <span class="s">&#39;package.json&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">watch: </span>
</span><span class='line'>      <span class="nv">bower:</span>
</span><span class='line'>        <span class="nv">files: </span><span class="p">[</span><span class="s">&quot;bower.json&quot;</span><span class="p">]</span>
</span><span class='line'>        <span class="nv">tasks: </span><span class="p">[</span><span class="s">&quot;bower-install&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="s">&#39;bower-install&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="nv">target: </span>
</span><span class='line'>        <span class="nv">src: </span><span class="s">&quot;index.html&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span> <span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="p">[]</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span>Gruntfile.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-bower-install&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-watch&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">pkg</span><span class="o">:</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="s1">&#39;package.json&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">watch</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">bower</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">files</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;bower.json&quot;</span><span class="p">],</span>
</span><span class='line'>        <span class="nx">tasks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;bower-install&quot;</span><span class="p">]</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="s1">&#39;bower-install&#39;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">target</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">src</span><span class="o">:</span> <span class="s2">&quot;index.html&quot;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[]);</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>We just needed to load the tasks of the plugin (<code>grunt.loadNpmTasks 'grunt-contrib-watch'</code>) then configure which task we want to trigger when the bower file is updated.</p>

<p>Last, we need to refresh our browser with livereload. In the previous versions of contrib-watch you needed to load the livereload plugin, but now, it&rsquo;s include so you just need to configure your watcher with:</p>

<figure class='code'><figcaption><span>Gruntfile.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="p">...</span>
</span><span class='line'>    <span class="nv">watch: </span>
</span><span class='line'>      <span class="nv">bower:</span>
</span><span class='line'>        <span class="nv">files: </span><span class="p">[</span><span class="s">&quot;bower.json&quot;</span><span class="p">]</span>
</span><span class='line'>        <span class="nv">tasks: </span><span class="p">[</span><span class="s">&quot;bower-install&quot;</span><span class="p">]</span>
</span><span class='line'>        <span class="nv">options:</span>
</span><span class='line'>          <span class="nv">livereload: </span><span class="kc">true</span>
</span><span class='line'><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Voil. Now start a server to visit your index.html file (for example with <code>python -m SimpleHTTPServer</code>) and enable <em>LiveReload</em> using <a href="https://chrome.google.com/webstore/detail/livereload/jnihajbhpnppcggbcgedagnkighmdlei">this extension</a> for example.</p>

<p>To try it, you can install a new bower dependency for example <code>bower install raphael --save</code> the &mdash;save will update your bower.json file so grunt will detect this change and update your html file, finally your browser will be refreshed.</p>

<p>Of course this is just an example of what is possible to do with <em>Grunt</em> you can really do a loooot of stuff. You can have a look on all <a href="http://gruntjs.com/plugins">available plugins</a> or you can also generate an application with <a href="http://microblog.anthonyestebe.com/2014-01-20/what-is-yeoman">yo</a> and look at the Gruntfile generated, this is really interesting. In the first post about Yeoman we generated a full stack application with express and angular, you can find the template for the Gruntfile <a href="https://raw2.github.com/DaftMonk/generator-angular-fullstack/master/templates/common/Gruntfile.js">here</a>.</p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:7;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:29:"What is Yeoman - part 3 Grunt";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:74:"http://microblog.anthonyestebe.com/2014-01-25/what-is-yeoman-part-3-grunt/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-01-25T14:58:40+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:73:"http://microblog.anthonyestebe.com/2014-01-25/what-is-yeoman-part-3-grunt";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:15147:"<p>Last tool about <em>Yeoman</em> and this is perhaps the more interesting because today I will talk about <em>Grunt</em>.</p>

<p><em>Grunt</em> is an awesome tool to help you to run some automatic tasks. Usually when you develop you have many times the same way to work and the same task to execute again and again like for example lint your js files or css, compile your sass or coffee files or different kinds of stuffs like that. Of course this is not really time consuming usually you can execute each task using one command line and even sometime like compiling your coffee you have some watcher already included.</p>

<p>Ok, but now what you think about having all those commands simplified in one file and many other and finally be able to run all your task automatically (even the ones without watcher like lint your files). <em>Grunt</em> do that.</p>

<!-- more -->


<p>Let&rsquo;s see a small example, basic, but enough to see how <em>Grunt</em> can be helpful. In the last article about <a href="http://microblog.anthonyestebe.com/2014-01-23/what-is-yeoman-part-2-bower">Bower</a> I was a bit frustrated to not be able to include all the scripts form third parties in the index html file so we will fix it now with <em>Grunt</em>.</p>

<p>From last article, we already have a bower.json file with <em>requirejs</em>, <em>bootstrap</em> and <em>underscore</em>. Now we need to add those scripts in the index.html using <em>Grunt</em>.</p>

<p>To create the base of your grunt project you need to have a package.json file using usually for node, if you don&rsquo;t have you can create a new one with <code>npm init</code>. After finish you should have a file like that.</p>

<figure class='code'><figcaption><span>package.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;testgrunt&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;grunt&quot;</span><span class="p">:</span> <span class="s2">&quot;~0.4.2&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;Gruntfile.js&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;grunt&quot;</span><span class="p">:</span> <span class="s2">&quot;~0.4.2&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now you can just run <code>npm install</code> and hop <em>grunt</em> is installed in your project. Of course if you try to execute the <code>grunt</code> command you will have an error because we didn&rsquo;t create the Gruntfile yet. This file is just a js (or coffee) file with the list of task you want to load and execute.</p>

<p>Here is the structure of this Gruntfile.</p>

<div>
                <figure class='code'><figcaption><span>Gruntfile.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="s">&#39;use strict&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">module.exports = </span><span class="nf">(grunt) -&gt;</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span>
</span><span class='line'>    <span class="nv">pkg: </span><span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span> <span class="s">&#39;package.json&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span> <span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="p">[]</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span>Gruntfile.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">pkg</span><span class="o">:</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="s1">&#39;package.json&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[]);</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>The <strong>initConfig</strong> function will be initialize with all needed configurations from your modules (here we include also the general config from package.json file sometime useful).</p>

<p>The <strong>registerTask</strong> function will create a new task (that you can call with <code>grunt mytask</code>) and trigger a list of subtasks.</p>

<p>In our case we want to install scripts in the html file using bower and if you check <a href="http://gruntjs.com/plugins">here</a> you have a huge list of plugins and there is one (bower-install) to <em>Inject your Bower dependencies right into your HTML from Grunt</em> so perfect.</p>

<p>To install it <code>npm install grunt-bower-install --save-dev</code>. The save-dev option will add the line automatically in your package.json.</p>

<p>Once installed we have to load tasks from this plugin with <code>grunt.loadNpmTasks 'grunt-bower-install'</code> in your Gruntfile then configure it following the documentation, in this case the Gruntfile looks like that.</p>

<div>
                <figure class='code'><figcaption><span>Gruntfile.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="s">&#39;use strict&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">module.exports = </span><span class="nf">(grunt) -&gt;</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-bower-install&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span>
</span><span class='line'>    <span class="nv">pkg: </span><span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span> <span class="s">&#39;package.json&#39;</span>
</span><span class='line'>    <span class="s">&#39;bower-install&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="nv">target: </span>
</span><span class='line'>        <span class="nv">src: </span><span class="s">&quot;index.html&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span> <span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="p">[]</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span>Gruntfile.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-bower-install&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">pkg</span><span class="o">:</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="s1">&#39;package.json&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="s1">&#39;bower-install&#39;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">target</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">src</span><span class="o">:</span> <span class="s2">&quot;index.html&quot;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[]);</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>With this plugin you should also put some code in your index.html where you want to inject your scripts and stylesheets.</p>

<figure class='code'><figcaption><span>index.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!doctype html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>  <span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="c">&lt;!-- bower:css --&gt;</span>
</span><span class='line'>    <span class="c">&lt;!-- endbower --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="c">&lt;!-- bower:js --&gt;</span>
</span><span class='line'>    <span class="c">&lt;!-- endbower --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now if you run the command <code>grunt bower-install</code> between the bower comments you will see your scripts and even css are added. Perhaps you notice and error, &ldquo;requirejs was not injected in your file&rdquo;. This is because grunt get the projects directly from Github and sometime some plugins like requirejs are not configured like grunt expect, but don&rsquo;t worry most of the time every plugins works perfectly.</p>

<p>So here it is we can now use bower to get our third party script then grunt to include them in the index file and in the next post we will see how to execute this task automatically everytime you load a new extension in your browser and how to have your browser up-to-date without doing anything and this will save a lot of time.</p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:8;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:29:"What is Yeoman - part 2 Bower";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:74:"http://microblog.anthonyestebe.com/2014-01-23/what-is-yeoman-part-2-bower/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-01-23T10:59:34+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:73:"http://microblog.anthonyestebe.com/2014-01-23/what-is-yeoman-part-2-bower";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:7214:"<p>After an introduction to <em>Yeoman</em> and the tool <em>Yo</em> <a href="http://microblog.anthonyestebe.com/2014-01-20/what-is-yeoman">few days ago</a>, today I will talk about the second tool from <em>Yeoman</em> workflow which is <em>Bower</em>.</p>

<p><em>Bower</em> is not a revolutionary tool but it&rsquo;s really useful. <em>Bower</em> is a like <em>NPM</em> (used for Node.js) for your front end scripts. If you don&rsquo;t know that tool, NPM is a package manager to help you to download and link the packages you want in your js application (using a nodejs server as development tool or server).</p>

<p>The problem when you create a new application with a lot of js is to resolve all dependencies.</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>...
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;jquery-2.0.0.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;require-2.1.10.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;bootstrap-3.0.3.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;underscore-1.5.2.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>For example this is really boring and will not work because this <code>bootstrap</code> version (3.0.3) depends on <code>jquery</code> 2.0.3 and we include the 2.0.0 version, moreover, you have to go to the website to download the library and include them in your project or use a CDN to deliver those scripts but in that case you cannot minify all in one script for production. So of course you can just be smart when you include your scripts with the right version and download them in a specific folder like vendors or third_party something like that or you can use <em>Bower</em>.</p>

<p>Let&rsquo;s do the same with <em>Bower</em> now (this should be already installed if you installed <em>yeoman</em> otherwise a simple <code>npm install -g bower</code> is enough).</p>

<p>First we have to initialize bower</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>bower init
</span></code></pre></td></tr></table></div></figure>


<p>After few questions to configure your application, this will create a file <strong>bower.json</strong>. This file will contains all your dependencies and your scripts.</p>

<p>Then we need to say which scripts we want so in our case <em>require.js</em>, <em>bootstrap</em>, <em>underscore</em> and <em>jquery</em>.
With <em>bower</em> you can install a script with the command <code>bower install</code> and your have the <code>--save</code> option to save this in your bower.json file.</p>

<p>So</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>bower install requirejs --save
</span><span class='line'>bower install bootstrap --save
</span><span class='line'>bower install underscore --save
</span></code></pre></td></tr></table></div></figure>


<p>I didn&rsquo;t include jquery because I know bootstrap need it so it will be include automatically I don&rsquo;t have to be worried about that but of course I can also type <code>bower install jquery --save</code></p>

<p>To be sure you can run a <code>bower list</code> to see all the scripts of your application and you will see jquery is include.</p>

<p>After that, all those informations will be saved in the bower.json file with.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'>  <span class="s2">&quot;dependencies&quot;</span><span class="err">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;requirejs&quot;</span><span class="p">:</span> <span class="s2">&quot;~2.1.10&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;underscore&quot;</span><span class="p">:</span> <span class="s2">&quot;~1.5.2&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;bootstrap&quot;</span><span class="p">:</span> <span class="s2">&quot;~3.0.3&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So now if you want to work with someone and to be sure (s)he will have the same version of your script, (s)he just have to run <code>bower install</code> and this will automatically download the right versions of each scripts.</p>

<p>Of course you still need to include those script in your html page, this cannot be fixed by <em>bower</em> and it&rsquo;s weird because there is all needed informations for that but we will see next time with <em>grunt</em>, the last tool or <em>yeoman</em>, how is it possible to even not write this.</p>

<p>And if you remember in the <a href="http://microblog.anthonyestebe.com/2014-01-20/what-is-yeoman">last post</a> we generated an application using <em>yo</em> and if you check on the code of this application you can see this bower.json file with all scripts included and already downloaded for this new generated application.</p>

<p>Just to resume right now we have all the organization of our files with all scripts already downloaded and even some page already created. We just need to be able now to build coffee scripts or SASS files for example or minify our sources for production and stuffs like that, and this will be the last tool of <em>yeoman</em> which is for me the best one to save a lot of time but we will see that in the next post ;)</p>

<p><a href="http://microblog.anthonyestebe.com/2014-01-25/what-is-yeoman-part-3-grunt">See part 3: Grunt</a></p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:9;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:14:"What is Yeoman";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:61:"http://microblog.anthonyestebe.com/2014-01-20/what-is-yeoman/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-01-20T12:10:15+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:60:"http://microblog.anthonyestebe.com/2014-01-20/what-is-yeoman";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:3873:"<p>I just realized I&rsquo;d never talked about some tools like Yo, Grunt or Bower so today I will fix this and I will talk about <em>Yeoman</em>&hellip;</p>

<p>First I saw on many blogs, poeple who are a bit confusing about <em>Yeoman</em>, <strong><em>Yeoman</em> is not a scaffolding tool</strong>, it is just an installer for 3 different tools:</p>

<ul>
<li><strong>Yo</strong>: This one is the scaffolding tool</li>
<li><strong>Bower</strong>: A package manager for your front end</li>
<li><strong>Grunt</strong>: A task runner</li>
</ul>


<div style="margin-top:20px;">
  <img src="http://yeoman.io/assets/img/yeoman-logo.a053.png" title="yeoman" alt="yeoman" style="float: left;width: 150px;margin: 0 20px;">

  <p>Even if <em>Yo</em> and <em>Yeoman</em> starts with the same letter it&#8217;s not a reason to mix them together ;) I think this confusion come because the same team is working on <em>Yo</em> and on <em>Yeoman</em> and moreover <em>Yo</em> generate configuration for bower and grunt which is some tools of <em>Yeoman</em> workflow. Anyway, this is close but keep thinking <em>Yeoman</em> is not a scaffolding tool but just a kind of workflow including awesome tools.</p>
</div>




<!-- more -->


<p>This post will be in 3 post, one for each tools.</p>

<h4>Yo:</h4>

<p><em>Yo</em> is the first tool of <em>Yeoman</em>, this tool is a scaffolding for your application.</p>

<p>Let&rsquo;s say you need to create a new application, for example an angular application with an expressjs server, <em>yo</em> will help you to startup your project, organize all your files, configure everything and even install some tools to be more productive like SASS or Coffee.</p>

<p>To do that, first you need to install <em>yo</em> with <code>npm install -g yo</code> and you&rsquo;re lucky because this will also install Bower and Grunt for the next parts ;)</p>

<p>Ok after that you need to find the right generator <a href="http://yeoman.io/community-generators.html">here</a>. And good there is one <em>angular-fullstack</em> (AngularJS with an Express server), exactly what we want.</p>

<p>To install it, you can just run <code>npm install -g generator-angular-fullstack</code>.</p>

<p>Now your generator is installed so we just have to generate our new app.</p>

<p>With the <code>yo</code> command you will be able to see all the generators already installed and when you select one this will run the generator, so select the one <em>Angular-fullstack</em> or type directly <code>yo angular-fullstack</code>.</p>

<p>That&rsquo;s it, now you just have to answer to the questions and your application will be generate.</p>

<p><img src="http://i42.tinypic.com/2rc72m8.jpg" title="generator questions" alt="generator questions" /></p>

<p>With this generator you will have:</p>

<ul>
<li>Your express server created</li>
<li>Your tests with karma</li>
<li>Your config for database and different environments</li>
<li>Your routes for your server</li>
<li>Your models</li>
<li>Your controllers</li>
<li>Your views</li>
<li>Your style</li>
<li>Your Angular application (routes, directives, controllers, services)</li>
</ul>


<p>And in bonus you will have</p>

<ul>
<li>Your Bower configured</li>
<li>Your Grunt configured</li>
</ul>


<p>So with this you saved many hours to organize and configure your new project and even now your project is ready to be deployed thanks to grunt but we will see that in a different post.</p>

<p><em>Yo</em> is really an awesome tool and the list of generator is really good. For now there is <a href="http://yeoman.io/community-generators.html">468 generators</a> for everything, you can have a chrome extension, a worpress, a firefox os app, threejs app&hellip; really impressive, just have a look.</p>

<p><a href="http://microblog.anthonyestebe.com/2014-01-23/what-is-yeoman-part-2-bower">See part 2: Bower</a></p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:10;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:23:"Pagination with angular";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:70:"http://microblog.anthonyestebe.com/2014-01-16/pagination-with-angular/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-01-16T14:59:37+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:69:"http://microblog.anthonyestebe.com/2014-01-16/pagination-with-angular";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:21760:"<p>Few days ago i talked about <a href="http://microblog.anthonyestebe.com/2014-01-11/infinite-scroll-with-angular">infinite scroll</a> but this was not really usefull without pagination so today we will see how to do some pagination using a <strong>Service</strong> like for <a href="http://microblog.anthonyestebe.com/2013-12-03/geolocalisation-and-address-completion-with-angular-and-google-map-api">the geolocalisation</a>.</p>

<p>Let&rsquo;s start now!</p>

<!-- more -->




<div>
                <figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">service</span> <span class="s">&quot;Pagination&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@paginate = </span><span class="nf">($scope, @resource, @maxElemPerPage=20, @onNewPage, @query={}) -&gt;</span>
</span><span class='line'>    <span class="vi">@page = </span><span class="mi">1</span>
</span><span class='line'>    <span class="vi">@canLoadNextPage = </span><span class="kc">true</span>
</span><span class='line'>    <span class="nv">$scope.loadPage = </span><span class="nf">(promise) =&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span> <span class="k">unless</span> <span class="nx">@canLoadNextPage</span>
</span><span class='line'>      <span class="nx">@load</span> <span class="nx">promise</span>
</span><span class='line'>
</span><span class='line'>    <span class="vi">@load = </span><span class="nf">(promise) =&gt;</span>
</span><span class='line'>      <span class="vi">@canLoadNextPage = </span><span class="kc">false</span>
</span><span class='line'>      <span class="nv">q = </span><span class="nx">angular</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">@query</span><span class="p">,</span> <span class="nv">page: </span><span class="nx">@page</span>
</span><span class='line'>      <span class="nx">@resource</span><span class="p">.</span><span class="nx">query</span> <span class="nx">q</span><span class="p">,</span> <span class="nf">(resources) =&gt;</span>
</span><span class='line'>        <span class="vi">@canLoadNextPage = </span><span class="kc">true</span> <span class="k">if</span> <span class="nx">resources</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="nx">@maxElemPerPage</span>
</span><span class='line'>        <span class="nx">@page</span><span class="o">++</span>
</span><span class='line'>        <span class="nx">@onNewPage</span> <span class="nx">resources</span> <span class="k">if</span> <span class="nx">@onNewPage</span>
</span><span class='line'>        <span class="nx">promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span> <span class="k">if</span> <span class="nx">promise</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">@load</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">@</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s2">&quot;Pagination&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">paginate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">resource</span><span class="p">,</span> <span class="nx">maxElemPerPage</span><span class="p">,</span> <span class="nx">onNewPage</span><span class="p">,</span> <span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">resource</span> <span class="o">=</span> <span class="nx">resource</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">maxElemPerPage</span> <span class="o">=</span> <span class="nx">maxElemPerPage</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">maxElemPerPage</span> <span class="o">:</span> <span class="mi">20</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">onNewPage</span> <span class="o">=</span> <span class="nx">onNewPage</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">query</span> <span class="o">=</span> <span class="nx">query</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">query</span> <span class="o">:</span> <span class="p">{};</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">canLoadNextPage</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">loadPage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">promise</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_this</span><span class="p">.</span><span class="nx">canLoadNextPage</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">promise</span><span class="p">);</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">load</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">promise</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">q</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">_this</span><span class="p">.</span><span class="nx">canLoadNextPage</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">q</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">page</span><span class="o">:</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">page</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">resource</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">q</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">resources</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">resources</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">maxElemPerPage</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">_this</span><span class="p">.</span><span class="nx">canLoadNextPage</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nx">_this</span><span class="p">.</span><span class="nx">page</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">onNewPage</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">_this</span><span class="p">.</span><span class="nx">onNewPage</span><span class="p">(</span><span class="nx">resources</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">promise</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>This service contains only one method <em>paginate</em>.</p>

<p>This method will add the <em>loadPage</em> function to your scope and finally load the first page. Everytime <em>loadPage</em> function is call, it will load the next page.</p>

<p>That&rsquo;s all, now we just need to initialize our controller to say which data we want to paginate.</p>

<div>
                <figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">controller</span> <span class="s">&quot;MyModelsIndexCtrl&quot;</span><span class="p">,</span> <span class="nf">($scope, @MyModel, @Pagination) -&gt;</span>
</span><span class='line'>  <span class="nv">$scope.myModels = </span><span class="p">[]</span>
</span><span class='line'>  <span class="nx">Pagination</span><span class="p">.</span><span class="nx">paginate</span> <span class="nx">$scope</span><span class="p">,</span> <span class="nx">MyModel</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nf">(myModels) -&gt;</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">myModels</span><span class="p">.</span><span class="nx">push</span> <span class="nx">myModel</span> <span class="k">for</span> <span class="nx">myModel</span> <span class="k">in</span> <span class="nx">myModels</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;MyModelsIndexCtrl&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">MyModel</span><span class="p">,</span> <span class="nx">Pagination</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">MyModel</span> <span class="o">=</span> <span class="nx">MyModel</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">Pagination</span> <span class="o">=</span> <span class="nx">Pagination</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">myModels</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">Pagination</span><span class="p">.</span><span class="nx">paginate</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">MyModel</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">myModels</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">myModel</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">myModels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">myModel</span> <span class="o">=</span> <span class="nx">myModels</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
</span><span class='line'>      <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">$scope</span><span class="p">.</span><span class="nx">myModels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">myModel</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>and because you can add a query you are also able to paginate following this query like that</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="p">...</span>
</span><span class='line'>    <span class="nx">Pagination</span><span class="p">.</span><span class="nx">paginate</span> <span class="nx">$scope</span><span class="p">,</span> <span class="nx">MyModel</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nf">(myModels) -&gt;</span>
</span><span class='line'>      <span class="nx">$scope</span><span class="p">.</span><span class="nx">myModels</span><span class="p">.</span><span class="nx">push</span> <span class="nx">myModel</span> <span class="k">for</span> <span class="nx">myModel</span> <span class="k">in</span> <span class="nx">myModels</span>
</span><span class='line'>    <span class="p">,</span> <span class="nv">q: </span><span class="p">{</span> <span class="nv">user_id_eq: </span><span class="mi">10</span><span class="p">,</span> <span class="nv">id_neq: </span><span class="nx">$scope</span><span class="p">.</span><span class="nx">myModel</span><span class="p">.</span><span class="nx">id</span> <span class="p">}</span> <span class="c1"># you can write what you want</span>
</span><span class='line'><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, if you use the infinite scroll from <a href="http://microblog.anthonyestebe.com/2014-01-11/infinite-scroll-with-angular">here</a> you just need in your view to have something like that</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">infinite-scroll=</span><span class="s">&quot;loadPage&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">ng-repeat=</span><span class="s">&quot;myModel in myModels&quot;</span><span class="nt">&gt;</span><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>and you will have automatic pagination without anything else.</p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:11;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:31:"Use a database without database";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:78:"http://microblog.anthonyestebe.com/2014-01-14/use-a-database-without-database/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-01-14T12:10:29+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:77:"http://microblog.anthonyestebe.com/2014-01-14/use-a-database-without-database";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:11978:"<p>Sometime when you develop a new application you don&rsquo;t really need to use any backend, you can do so many things now with javascript and all html5 api but one thing you cannot do is to persist your data to be accessible everywhere (yes I just talk about database&hellip;).</p>

<p>When you have just few data to save in a global database it&rsquo;s really boring to have to create a full backend with routing, database access, api&hellip; just in order to save few data. Recently I had to work in this kind of project were data are not so important and everything is done locally and even data is stored locally but some have to be synchronized for everyone. Usually I create a simple <em>node</em> server with a database access but this is too much work.</p>

<!-- more -->


<p>After some research I found <a href="http://www.mongohq.com/">MongoHQ</a>, ok this is not new, I already used it many times when I used some mongo database on heroku for example but in fact this is a bit more because you can create your own database and access directly with a <strong>REST API</strong> and this is good !</p>

<p>Here is a piece of code to do almost everything you need</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">_apikey</span><span class="o">:</span> <span class="s1">&#39;YOUR_API_KEY&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">_database</span><span class="o">:</span> <span class="s1">&#39;YOUR_DATABASE&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">_id</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">_id</span><span class="p">.</span><span class="nx">$oid</span><span class="p">;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">url</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span> <span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;https://api.mongohq.com/databases/&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_database</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;/collections/&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">collection</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;/documents/&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">id</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;?_apikey=&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_apikey</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">$http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">id</span><span class="p">));</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">list</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">$http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">(</span><span class="nx">collection</span><span class="p">));</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">$http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">(</span><span class="nx">collection</span><span class="p">),</span> <span class="p">{</span>
</span><span class='line'>      <span class="nb">document</span><span class="o">:</span> <span class="nb">document</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nb">document</span><span class="p">);</span>
</span><span class='line'>    <span class="k">delete</span> <span class="nx">data</span><span class="p">.</span><span class="nx">$$hashKey</span><span class="p">;</span> <span class="c1">// hack because of angular model</span>
</span><span class='line'>    <span class="k">delete</span> <span class="nx">data</span><span class="p">.</span><span class="nx">_id</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">$http</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">(</span><span class="nb">document</span><span class="p">)),</span> <span class="p">{</span>
</span><span class='line'>      <span class="nb">document</span><span class="o">:</span> <span class="nx">data</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="k">delete</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">$http</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">(</span><span class="nb">document</span><span class="p">)));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ok with this now you can have your database without any backend to create. Now if you want to fetch all your users for exemple you just have to execute</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="s2">&quot;users&quot;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">users</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Thats all and for some who didn&rsquo;t undertand the $http, it&rsquo;s like the $.ajax in jquery. I just realize now I should change this and use a <a href="http://microblog.anthonyestebe.com/2013-12-03/geolocalisation-and-address-completion-with-angular-and-google-map-api/">Service</a> with angular to manage the database access&hellip; Maybe another article</p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:12;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:28:"Infinite scroll with angular";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:75:"http://microblog.anthonyestebe.com/2014-01-11/infinite-scroll-with-angular/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-01-11T13:32:21+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:74:"http://microblog.anthonyestebe.com/2014-01-11/infinite-scroll-with-angular";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:15731:"<p>Today let&rsquo;s see how to create a simple infinite scroll using directives with angular.</p>

<p>The algorithm for an infinite scroll is pretty simple, you just have to check everytime your user use the scroll if the bottom of your element it close to the bottom of the visible area of the user (the bottom of the page because everything after will not be visible so nothing should appear after even footer ;) ).</p>

<!-- more -->




<div>
                <figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s">&#39;infiniteScroll&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span class='line'><span class="p">.</span><span class="nx">directive</span> <span class="s">&#39;infiniteScroll&#39;</span><span class="p">,</span> <span class="nf">($window, $q) -&gt;</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nv">link: </span><span class="nf">(scope, element, attrs) -&gt;</span>
</span><span class='line'>      <span class="nv">offset = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">offset</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">10</span>
</span><span class='line'>      <span class="nv">scrolling = </span><span class="kc">false</span>
</span><span class='line'>      <span class="nx">angular</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="nx">$window</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&#39;scroll&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">not</span> <span class="nx">scrolling</span> <span class="o">and</span> <span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offsetParent</span><span class="o">?</span><span class="p">.</span><span class="nx">offsetTop</span> <span class="o">+</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">$window</span><span class="p">.</span><span class="nx">scrollY</span> <span class="o">+</span> <span class="nx">$window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">-</span> <span class="nx">offset</span>
</span><span class='line'>          <span class="nv">scrolling = </span><span class="kc">true</span>
</span><span class='line'>          <span class="nv">deferred = </span><span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">()</span>
</span><span class='line'>          <span class="nx">scope</span><span class="p">[</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">infiniteScroll</span><span class="p">](</span><span class="nx">deferred</span><span class="p">)</span>
</span><span class='line'>          <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span> <span class="nf">-&gt;</span>
</span><span class='line'>            <span class="nv">scrolling = </span><span class="kc">false</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;infiniteScroll&#39;</span><span class="p">,</span> <span class="p">[]).</span><span class="nx">directive</span><span class="p">(</span><span class="s1">&#39;infiniteScroll&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$window</span><span class="p">,</span> <span class="nx">$q</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">link</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">element</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">scrolling</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">offset</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">offset</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">scrolling</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="nx">$window</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">deferred</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">scrolling</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offsetParent</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">offsetTop</span> <span class="o">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">$window</span><span class="p">.</span><span class="nx">scrollY</span> <span class="o">+</span> <span class="nx">$window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">scrolling</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>          <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
</span><span class='line'>          <span class="nx">scope</span><span class="p">[</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">infiniteScroll</span><span class="p">](</span><span class="nx">deferred</span><span class="p">);</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">scrolling</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>Ok now I explain some choices in this code.</p>

<ul>
<li>I used a boolean to know if it&rsquo;s scrolling or not to avoid multiple calls when you load something for example</li>
<li>The condition check if it&rsquo;s not scrolling and if the bottom of the element is less than the bottom of the page minus an offset</li>
<li>I use a deferred object to be able to have an asynchronous call (ajax for example) and just have to resolve the deferred object when everything is complete, no need any callback</li>
</ul>


<p>Right, this was the biggest part, now to use it you simply have to add the <strong>infinite-scroll</strong> attribute with the function to call and everytime you will arrive at the end of the page this function will be call and you will just have to resolve your deferred object when everything is done</p>

<div>
                <figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s">&#39;app&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;infiniteScroll&#39;</span><span class="p">])</span>
</span><span class='line'><span class="p">.</span><span class="nx">controller</span> <span class="s">&#39;myCtrl&#39;</span><span class="p">,</span> <span class="nf">($scope) -&gt;</span>
</span><span class='line'>  <span class="nv">$scope.data = </span><span class="p">[]</span>
</span><span class='line'>  <span class="nv">$scope.loadNew = </span><span class="nf">(deferredObj) -&gt;</span>
</span><span class='line'>    <span class="c1"># add some data in your data array</span>
</span><span class='line'>    <span class="nx">deferredObj</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;infiniteScroll&#39;</span><span class="p">]).</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;myCtrl&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">loadNew</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">deferredObj</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">deferredObj</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  <span class="nt">&lt;div</span> <span class="na">infinite-scroll=</span><span class="s">&quot;loadNew&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">ng-repeat=</span><span class="s">&quot;d in data&quot;</span><span class="nt">&gt;</span><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Everything is done, in just few lines you can have an infinite scroll. In the next days, I will do an article to use pagination with angular and to link the infinite scroll with this pagination.</p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:13;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:34:"Index your single page app for SEO";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:81:"http://microblog.anthonyestebe.com/2014-01-10/index-your-single-page-app-for-seo/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2014-01-10T11:02:07+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:80:"http://microblog.anthonyestebe.com/2014-01-10/index-your-single-page-app-for-seo";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:3223:"<p>After few days without any news I come back with many ideas of article on different subjects. First of them how to let google and other search engines visit your application when this one is develop with some frameworks like <em>angular</em>, <em>backbone</em>, <em>ember</em>&hellip; Those kind of frameworks are really helpful to significantly improve the user experience but horrible when you want to index your pages for <strong>seo</strong>.</p>

<p>First we have to know how search engines works&hellip; To be simple they will just download the page associated to one url and after they will parse this page to detect you text, your links etc&hellip; So in our case, this page will return all the time the same content. Try to execute the curl command on your website and you will understand what google index.</p>

<!-- more -->


<p>There is different way to try to improve a bit this like using pushState or use your url with <a href="https://developers.google.com/webmasters/ajax-crawling/docs/getting-started">!#</a> instead of # but those solutions are not really perfect.</p>

<p>And now thanks to technologies like phantomjs you can crawl this kind of application (and test it also ;)) and one solution is to use this technology to navigate in your application then when the page is fully loaded save it as static page like that when the search engine will ask for this page you will render the page with all the content already loaded. This is the perfect way but it&rsquo;s a bit complicated to do it and it take long time and as a developer we should be lazy so after some research I found <strong><a href="https://prerender.io">prerender.io</a></strong>.</p>

<h2>Prerender.io</h2>

<p>This service will help you in 3 steps:</p>

<ul>
<li>Submitting your url to create the html version of your fully loaded page.</li>
<li>Link this page to your application like that search engines will have access on it.</li>
<li>Cache those pages to ensure quick delivery.</li>
</ul>


<p>Only one problem left, the time to recreate your pages&hellip; You can select in there pricing how often you want to refresh all your pages but because they are cool they even let you recreate one page using the api so like that you can refresh your cache every weeks per example and when you need (because someone post something in your application) you can just call the api and you will have your page in cache.</p>

<p>There is many other services to do that but this one is pretty cool because there goal is really to simplify your work and not only to get money from you because first there is a free plan (like others similar services) and also because you can access to there source code and develop your own prerender engine and they even say you can refresh your cache from the api when you want so you don&rsquo;t need to buy the most expensive plan but of course you will have to develop a bit more so after that you are really free to decide what you want.</p>

<p><em>Note: This post is about SEO but also for social networks when you share one link, social networks will not be able to read data added using ajax like metadata of your content (ex: Opengraph with Facebook or Pinterest or Twitter cards)</em></p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:14;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:21:"Comments in your code";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:68:"http://microblog.anthonyestebe.com/2013-12-18/comments-in-your-code/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2013-12-18T20:01:35+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:67:"http://microblog.anthonyestebe.com/2013-12-18/comments-in-your-code";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:3172:"<p>Today I will talk about comments in your code.</p>

<p>There is two kind of people for that.</p>

<ul>
<li>The ones who comment <em>everything</em> in the code</li>
<li>The ones who comment <em>nothing</em> in the code</li>
</ul>


<p>I will not say one solution is better than another, I will just try to explain (in my opinion) why we choose one or the other method and what are the benefits and the problems.</p>

<!--more-->


<p><strong>Comment everything</strong></p>

<p><em>Pro:</em></p>

<ul>
<li>No one can tell you didn&rsquo;t comment enough your code (useful when you work in a big company and you have some tools to check if the code is well commented)</li>
<li>You can know quickly what your function do, what it will return, what kind of parameters are needed&hellip; (the same for your object)</li>
<li>You can give your code to someone, (s)he will understand what to use and how to use quickly</li>
<li>Really good to generate external documentations automatically</li>
</ul>


<p><em>Con:</em></p>

<ul>
<li>Difficult to read your code, when you have half code half comment you cannot focus enough on your code</li>
<li>Lose time for refactoring/maintaining of your code, when you have to change one function you also have to change associated comments</li>
<li>Really hard to maintain (yes again) if you forget to change one comment after refactoring or one bug fix this can be horrible because people will focus on the documentation and this one will be false</li>
<li>Temptation to write bigger functions/class because developers don&rsquo;t like to comment, instead of having 10 functions of 2-3 lines (and 10 times 5 lines of comments) you will quickly have 1 function of 20-30 lines (and 1 time 5 lines of comments) even sometime a lot more&hellip;</li>
</ul>


<p><strong>Comment nothing</strong></p>

<p><em>Pro:</em></p>

<ul>
<li>Code is only code, you can just focus on your job</li>
<li>Easier to separate, because you have no comments you need to have functions/class quickly understandable and so reduce/split your code</li>
<li>Easy to detect bullshit code, when you think you have to put a comment to explain something, it means this part need to be re-factored</li>
<li>Force to have a clear code with full of meaning for variable name, functions name etc&hellip; forget about i, k, v&hellip;</li>
</ul>


<p><em>Con:</em></p>

<ul>
<li>Difficult for a new developer to understand how to use your code</li>
<li>Have to focus more on your code to have something clear (sometime spend more than one minute to decide the name of your variables)</li>
<li>Need to spend more time when you will have to create a full documentation (for a public API for example)</li>
</ul>


<p>Of course this is only my opinion, perhaps you will not share my point of view and I will be happy to discuss about it, for me I don&rsquo;t like to write useless stuff and comments are useless if your code is clear enough and when you decide to not comment you have to work more to have a code clear and easy to understand which is good when you want to refactor it. When you choose to code without comment you choose also to have a code better than ever.</p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:15;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:32:"Grid Pinterest like with Angular";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:79:"http://microblog.anthonyestebe.com/2013-12-14/grid-pinterest-like-with-angular/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2013-12-14T00:50:16+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:78:"http://microblog.anthonyestebe.com/2013-12-14/grid-pinterest-like-with-angular";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:31094:"<p>After few days without posting because I was traveling back to france, today I will talk about one way to create a grid like Pinterest. There is many plugins to do that but most of them are really big and based on jquery so you need to load a lot of stuff just to use 10% of a library. So I decided to develop my own one just using directives in angular and this without jquery or alternative lib.</p>

<p>So first we will have to think about what we need.</p>

<p>We need:</p>

<ul>
<li>to compute the width of the grid</li>
<li>to compute the height of the grid</li>
<li>to compute the number of elements per rows</li>
<li>to compute the positions of each elements</li>
</ul>


<p>And my goal is to use it like that</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;grid</span> <span class="na">list=</span><span class="s">&quot;my_list&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  this is my element  <span class="c">&lt;!-- the display of my element --&gt;</span>
</span><span class='line'><span class="nt">&lt;/grid&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<!--more-->


<p>So let&rsquo;s create the template for this new directive.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">resize</span> <span class="na">ng-style=</span><span class="s">&#39;computePositions()&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">ng-repeat=</span><span class="s">&#39;elem in list&#39;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>For now, nothing really complicated, one container with a style computed and inside the <em>ng-repeat</em> with my list. You can see the <a href="http://microblog.anthonyestebe.com/2013-11-30/window-resize-event-with-angular">resize directive</a> I introduce in a previous article.</p>

<div>
                <figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">directive</span> <span class="s">&#39;grid&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nv">restrict: </span><span class="s">&#39;E&#39;</span>
</span><span class='line'>    <span class="nv">replace: </span><span class="kc">true</span>
</span><span class='line'>    <span class="nv">template: </span><span class="s">&quot;&lt;div resize ng-style=&#39;computePositions()&#39;&gt;&lt;div ng-repeat=&#39;elem in list&#39;&gt;&lt;/div&gt;&lt;/div&gt;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">scope:</span>
</span><span class='line'>      <span class="nv">list: </span><span class="s">&quot;=&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">controller: </span><span class="nf">($scope, $element, $attrs) -&gt;</span>
</span><span class='line'>      <span class="nv">parent     = </span><span class="nx">$element</span><span class="p">.</span><span class="nx">parent</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">margin      = </span>         <span class="nf">-&gt;</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$attrs</span><span class="p">.</span><span class="nx">margin</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">15</span>
</span><span class='line'>      <span class="nv">width       = </span>         <span class="nf">-&gt;</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="o">||</span> <span class="mi">225</span>
</span><span class='line'>      <span class="nv">elemWidth   = </span>         <span class="nf">-&gt;</span> <span class="nx">width</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">margin</span><span class="p">()</span>
</span><span class='line'>      <span class="nv">elemHeight  = </span><span class="nf">(height) -&gt;</span> <span class="nx">height</span>  <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">margin</span><span class="p">()</span>
</span><span class='line'>      <span class="nv">elemPerLine = </span>         <span class="nf">-&gt;</span> <span class="nb">parseInt</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">offsetWidth</span> <span class="o">/</span> <span class="nx">elemWidth</span><span class="p">(),</span> <span class="mi">10</span>
</span><span class='line'>      <span class="nv">gridWidth   = </span>         <span class="nf">-&gt;</span> <span class="nx">elemPerLine</span><span class="p">()</span> <span class="o">*</span> <span class="nx">elemWidth</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$scope.computePositions = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">restrict</span><span class="o">:</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">replace</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;&lt;div resize ng-style=&#39;computePositions()&#39;&gt;&lt;div ng-repeat=&#39;elem in list&#39;&gt;&lt;/div&gt;&lt;/div&gt;&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">scope</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">list</span><span class="o">:</span> <span class="s2">&quot;=&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">controller</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$element</span><span class="p">,</span> <span class="nx">$attrs</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">elemHeight</span><span class="p">,</span> <span class="nx">elemPerLine</span><span class="p">,</span> <span class="nx">elemWidth</span><span class="p">,</span> <span class="nx">gridWidth</span><span class="p">,</span> <span class="nx">margin</span><span class="p">,</span> <span class="nx">parent</span><span class="p">,</span> <span class="nx">width</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">parent</span> <span class="o">=</span> <span class="nx">$element</span><span class="p">.</span><span class="nx">parent</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>      <span class="nx">margin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$attrs</span><span class="p">.</span><span class="nx">margin</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">15</span><span class="p">;</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>      <span class="nx">width</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">225</span><span class="p">;</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>      <span class="nx">elemWidth</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">width</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">margin</span><span class="p">();</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>      <span class="nx">elemHeight</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">height</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">margin</span><span class="p">();</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>      <span class="nx">elemPerLine</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">parent</span><span class="p">.</span><span class="nx">offsetWidth</span> <span class="o">/</span> <span class="nx">elemWidth</span><span class="p">(),</span> <span class="mi">10</span><span class="p">);</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>      <span class="nx">gridWidth</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">elemPerLine</span><span class="p">()</span> <span class="o">*</span> <span class="nx">elemWidth</span><span class="p">();</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">computePositions</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>Here is the first part of the directive, we just define some functions to help a bit the computation, like the margin between each elements which can be gave as a parameter of the grid, the same for the width of elements then the full width and height of elements including margins, the number of elements by row and the width of the grid. Now we can create the <code>computePositions</code> function.</p>

<p>This function will compute the position for each elements and then return the style of the grid.</p>

<div>
                <figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">$scope.computePositions = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">bottoms    = </span><span class="p">(</span><span class="mi">0</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">elemPerLine</span><span class="p">()])</span>
</span><span class='line'>  <span class="nv">maxHeight = </span><span class="mi">0</span>
</span><span class='line'>  <span class="k">for</span> <span class="nx">elem</span> <span class="k">in</span> <span class="nx">$element</span><span class="p">.</span><span class="nx">children</span><span class="p">()</span>
</span><span class='line'>    <span class="nv">top   = </span><span class="kc">null</span>
</span><span class='line'>    <span class="nv">index = </span><span class="mi">0</span>
</span><span class='line'>    <span class="k">for</span> <span class="nx">bottom</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">bottoms</span> <span class="k">when</span> <span class="o">not</span> <span class="nx">top</span><span class="o">?</span> <span class="o">or</span> <span class="nx">top</span> <span class="o">&gt;</span> <span class="nx">bottom</span>
</span><span class='line'>      <span class="nv">top   = </span><span class="nx">bottom</span>
</span><span class='line'>      <span class="nv">index = </span><span class="nx">i</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">left   = </span><span class="p">(</span><span class="nx">index</span> <span class="o">*</span> <span class="nx">elemWidth</span><span class="p">())</span> <span class="o">%</span> <span class="nx">gridWidth</span><span class="p">()</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">()</span>
</span><span class='line'>    <span class="nv">height = </span><span class="nx">top</span> <span class="o">+</span> <span class="nx">elemHeight</span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">maxHeight = </span><span class="nx">height</span> <span class="k">if</span> <span class="nx">maxHeight</span> <span class="o">&lt;</span> <span class="nx">height</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">bottoms</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>  <span class="o">=</span> <span class="nx">height</span>
</span><span class='line'>    <span class="nv">elem.style.left = </span><span class="nx">left</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span>
</span><span class='line'>    <span class="nv">elem.style.top  = </span><span class="nx">top</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nv">width: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">gridWidth</span><span class="p">()</span><span class="si">}</span><span class="s">px&quot;</span>
</span><span class='line'>    <span class="nv">height: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">maxHeight</span><span class="si">}</span><span class="s">px&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$scope</span><span class="p">.</span><span class="nx">computePositions</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">bottom</span><span class="p">,</span> <span class="nx">bottoms</span><span class="p">,</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">maxHeight</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_len1</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">bottoms</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">,</span> <span class="nx">_results</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">_results</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">elemPerLine</span><span class="p">();</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">_ref</span> <span class="o">?</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_ref</span> <span class="o">:</span> <span class="nx">_i</span> <span class="o">&gt;</span> <span class="nx">_ref</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">_ref</span> <span class="o">?</span> <span class="o">++</span><span class="nx">_i</span> <span class="o">:</span> <span class="o">--</span><span class="nx">_i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">_results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">_results</span><span class="p">;</span>
</span><span class='line'>  <span class="p">})();</span>
</span><span class='line'>  <span class="nx">maxHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">$element</span><span class="p">.</span><span class="nx">children</span><span class="p">();</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">elem</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
</span><span class='line'>    <span class="nx">top</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len1</span> <span class="o">=</span> <span class="nx">bottoms</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="o">++</span><span class="nx">_j</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">bottom</span> <span class="o">=</span> <span class="nx">bottoms</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="nx">top</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">||</span> <span class="nx">top</span> <span class="o">&gt;</span> <span class="nx">bottom</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">top</span> <span class="o">=</span> <span class="nx">bottom</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">index</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">left</span> <span class="o">=</span> <span class="p">(</span><span class="nx">index</span> <span class="o">*</span> <span class="nx">elemWidth</span><span class="p">())</span> <span class="o">%</span> <span class="nx">gridWidth</span><span class="p">()</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">height</span> <span class="o">=</span> <span class="nx">top</span> <span class="o">+</span> <span class="nx">elemHeight</span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">maxHeight</span> <span class="o">&lt;</span> <span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">maxHeight</span> <span class="o">=</span> <span class="nx">height</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">bottoms</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">height</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">elem</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">left</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">elem</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">top</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">width</span><span class="o">:</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">gridWidth</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">height</span><span class="o">:</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">maxHeight</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>To keep it simple, this algorithm will create an array to store the bottom of each columns and add the position of the element to the smallest column (the one with the smallest bottom).</p>

<p>Now you just need to set your grid container in relative and your items as absolute and it&rsquo;s done and because of the resize, everytime you will resize your window, all the positions will be recomputed to be sure to maximize the number of items in your container.</p>

<p data-height="495" data-theme-id="0" data-slug-hash="cxgpF" data-user="antho1404" data-default-tab="result" class='codepen'>See the Pen <a href='http://codepen.io/antho1404/pen/cxgpF'>cxgpF</a> by Anthony (<a href='http://codepen.io/antho1404'>@antho1404</a>) on <a href='http://codepen.io'>CodePen</a></p>


<script async src="http://microblog.anthonyestebe.com//codepen.io/assets/embed/ei.js"></script>

";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:16;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:32:"Create some filters with Angular";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:79:"http://microblog.anthonyestebe.com/2013-12-09/create-some-filters-with-angular/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2013-12-09T15:41:35+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:78:"http://microblog.anthonyestebe.com/2013-12-09/create-some-filters-with-angular";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:7814:"<p>I continue again with angular. I&rsquo;m working on a new project with this framework and it&rsquo;s really pleasant to use it. After <a href="http://microblog.anthonyestebe.com/2013-11-30/window-resize-event-with-angular">directives</a> and <a href="http://microblog.anthonyestebe.com/2013-12-03/geolocalisation-and-address-completion-with-angular-and-google-map-api">services</a> today I will speak about <em>filters</em>.</p>

<p>First, what is a filter ?</p>

<p>A filter is something which will transform your data. One good example is the use of the filter &lsquo;filter&rsquo; which will search in an array all elements which contains a part of the search. Filter is not limited to array, it is just an input, some parameters and you process your input to have a result so you can apply a filter on a string element or number or whatever. Perhaps you already try to display a date as string. With angular there is already a filter for this and you can simply write.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>myDate | date:'yyyy-MM-dd'</span></code></pre></td></tr></table></div></figure>


<p>Let explain this a bit.</p>

<!--more-->


<ul>
<li><code>myDate</code> is the data you want to process.</li>
<li><code>|</code> is the instruction to say to angular I want to use a filter</li>
<li><code>date</code> is the filter I want to use</li>
<li><code>:</code> the separator to give some parameters to my filter</li>
<li><code>'yyyy-MM-dd'</code> the format of the date I want</li>
</ul>


<p>Ok now everything is understood (I hope), we can create a new filter. I will take a simple case like just truncate a text. I would like to be able to truncate a long text with a filter. So my goal is to write this.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>myLongText | truncate:100:'...'</span></code></pre></td></tr></table></div></figure>


<p>In this instruction I will truncate myLongText to have 100 characters and finishing with &lsquo;&hellip;&rsquo;</p>

<div>
                <figure class='code'><figcaption><span>filter/truncate.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">App = </span><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&quot;app&quot;</span><span class="p">,</span> <span class="p">[]</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">filter</span> <span class="s">&#39;truncate&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nf">(text, length, end) -&gt;</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">text</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">text</span> <span class="o">or</span> <span class="nx">text</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="nx">length</span>
</span><span class='line'>    <span class="nx">text</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">-</span> <span class="nx">end</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">+</span> <span class="nx">end</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span>filter/truncate.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">App</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">App</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="p">[]);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;truncate&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">text</span> <span class="o">||</span> <span class="nx">text</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">text</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">text</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">-</span> <span class="nx">end</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">+</span> <span class="nx">end</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>That&rsquo;s all !!</p>

<p>I just have to create a filter and return a function with my data as first argument then all the other arguments I want and this function will return the data after processing.</p>

<p>This is a simple case but a filter shouldn&rsquo;t be complicated. Most of filters should have only 10 lines maximum but it can be really easy to read your code after and to find problems. So if you are using Angular, use and re-use a lot filters ;)</p>

<p data-height="366" data-theme-id="0" data-slug-hash="iwAeG" data-user="antho1404" data-default-tab="result" class='codepen'>See the Pen <a href='http://codepen.io/antho1404/pen/iwAeG'>iwAeG</a> by Anthony (<a href='http://codepen.io/antho1404'>@antho1404</a>) on <a href='http://codepen.io'>CodePen</a></p>


<script async src="http://microblog.anthonyestebe.com//codepen.io/assets/embed/ei.js"></script>

";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:17;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:36:"Packages for Inherited Resources gem";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:83:"http://microblog.anthonyestebe.com/2013-12-06/packages-for-inherited-resources-gem/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2013-12-06T14:35:02+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:82:"http://microblog.anthonyestebe.com/2013-12-06/packages-for-inherited-resources-gem";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:22438:"<p>When I work with Ruby on Rails, I like to write the less I can for the server side part and one gem is perfect for this <a href="https://github.com/josevalim/inherited_resources">inherited_resources</a>. This gem permits to create <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a> controllers without anything to write in your controller.</p>

<figure class='code'><figcaption><span>app/controllers/products_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="ss">InheritedResources</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>config/routes.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">MyApp</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:products</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Only with this, now you can Create, Read, Update and Delete your users. It&rsquo;s cool but sometimes you need to have a search or apply a scope, a pagination&hellip;
For this I decided to add some module to do that.</p>

<ul>
<li>Scope: Apply a scope</li>
<li>Search: Search using <a href="https://github.com/activerecord-hackery/meta_search">meta_search</a></li>
<li>Order: Reorder your collection</li>
<li>Pagination: Paginate your results using <a href="https://github.com/amatsuda/kaminari">kaminari</a></li>
<li>BuildWithCurrentUser: Create/Update your resource with the current user</li>
</ul>


<!--more-->




<figure class='code'><figcaption><span>scope.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">InheritedResourcesModules</span>
</span><span class='line'>  <span class="c1"># Scope</span>
</span><span class='line'>  <span class="c1"># Sometime it can be usefull to scope any request using the scopes defined in the model</span>
</span><span class='line'>  <span class="c1"># ex:</span>
</span><span class='line'>  <span class="c1"># a class Article with the scope published</span>
</span><span class='line'>  <span class="c1"># scope :published -&gt; { Article.arel_table[:published_at].lteq Time.now }  # published_at &lt; Time.now</span>
</span><span class='line'>  <span class="c1">#</span>
</span><span class='line'>  <span class="c1"># including this module in the controller permits to automatically call this scope when the parameter scope=published is given</span>
</span><span class='line'>  <span class="c1"># /articles?scope=published  will return all articles published</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Scope</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># overwrite method call at the end of the process</span>
</span><span class='line'>    <span class="c1"># in this method we will just call the scope with the name given in parameter for the ActiveRecord::Relation</span>
</span><span class='line'>    <span class="c1"># if no scope is given simply return the ActiveRecord::Relation from super method</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">end_of_association_chain</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:scope</span><span class="o">].</span><span class="n">present?</span>
</span><span class='line'>        <span class="k">super</span><span class="o">.</span><span class="n">send</span> <span class="n">params</span><span class="o">[</span><span class="ss">:scope</span><span class="o">]</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="k">super</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>search.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">InheritedResourcesModules</span>
</span><span class='line'>  <span class="c1"># Search</span>
</span><span class='line'>  <span class="c1"># This module will use meta_search gem to search in inherited_resources controllers</span>
</span><span class='line'>  <span class="c1"># ex:</span>
</span><span class='line'>  <span class="c1"># want to search for articles where the author_id is 3</span>
</span><span class='line'>  <span class="c1"># /articles/?q[author_id_eq]=3</span>
</span><span class='line'>  <span class="c1"># more details with documentation of meta_search</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Search</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># overwrite method call at the end of the process</span>
</span><span class='line'>    <span class="c1"># in this method we will get the parameters needed for the search and apply this search filter to the chain</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">end_of_association_chain</span>
</span><span class='line'>      <span class="n">search</span> <span class="o">=</span> <span class="k">super</span><span class="o">.</span><span class="n">search</span> <span class="n">params</span><span class="o">[</span><span class="ss">:q</span><span class="o">]</span>
</span><span class='line'>      <span class="n">search</span><span class="o">.</span><span class="n">relation</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>pagination.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">InheritedResourcesModules</span>
</span><span class='line'>  <span class="c1"># Pagination</span>
</span><span class='line'>  <span class="c1"># When you work with a big collection, it can be very convinient to paginate the results</span>
</span><span class='line'>  <span class="c1"># including this module, your collection will be paginate using the page given by the parameter page</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Pagination</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># overwrite method call at the end of the process</span>
</span><span class='line'>    <span class="c1"># in this method we will just paginate the result with the params page</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># WARNING:</span>
</span><span class='line'>    <span class="c1"># this module should be included at the end because it doesn&#39;t return an ActiveRecord::Relation object</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">end_of_association_chain</span>
</span><span class='line'>      <span class="n">chain</span> <span class="o">=</span> <span class="k">super</span>
</span><span class='line'>      <span class="n">chain</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">page</span> <span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">].</span><span class="n">present?</span>
</span><span class='line'>      <span class="n">chain</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>order.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">InheritedResourcesModules</span>
</span><span class='line'>  <span class="c1"># Order</span>
</span><span class='line'>  <span class="c1"># Add the possibility to reorder one api call</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Order</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># overwrite method call at the end of the process</span>
</span><span class='line'>    <span class="c1"># in this method we will check the order paramater require to reorder the collection and extract the table name</span>
</span><span class='line'>    <span class="c1"># the column and the order wanted</span>
</span><span class='line'>    <span class="c1"># ex:</span>
</span><span class='line'>    <span class="c1"># To reorder Article collection by published_at ASC simply call with</span>
</span><span class='line'>    <span class="c1">#   /articles.json?order=published_at_asc</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># if wanted to reorder using another table attribute like the name of the author</span>
</span><span class='line'>    <span class="c1">#   /articles.json?order=author.name_asc</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">end_of_association_chain</span>
</span><span class='line'>      <span class="n">chain</span> <span class="o">=</span> <span class="k">super</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:order</span><span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:order</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/^([\w\_\.]+)_(desc|asc)$/</span>
</span><span class='line'>        <span class="n">column</span> <span class="o">=</span> <span class="vg">$1</span>
</span><span class='line'>        <span class="n">order</span>  <span class="o">=</span> <span class="vg">$2</span>
</span><span class='line'>        <span class="n">table</span>  <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:controller</span><span class="o">].</span><span class="n">singularize</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">constantize</span><span class="o">.</span><span class="n">table_name</span>
</span><span class='line'>        <span class="n">table_column</span> <span class="o">=</span> <span class="p">(</span><span class="n">column</span> <span class="o">=~</span> <span class="sr">/\./</span><span class="p">)</span> <span class="p">?</span> <span class="n">column</span> <span class="p">:</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">table</span><span class="si">}</span><span class="s2">.</span><span class="si">#{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">chain</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">table_column</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">order</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">chain</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>build_with_current_user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">InheritedResourcesModules</span>
</span><span class='line'>  <span class="c1"># BuildWithCurrentUser</span>
</span><span class='line'>  <span class="c1"># force the user of the object to be the current user when create resource</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">BuildWithCurrentUser</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># overwrite create method to build the resource with the current user and force the creation of</span>
</span><span class='line'>    <span class="c1"># the collection variable @articles for ArticlesController. Need to check why it&#39;s necessary to</span>
</span><span class='line'>    <span class="c1"># user @articles instead of @article to work with rabl gem</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>      <span class="n">set_user</span>
</span><span class='line'>      <span class="n">create!</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">update</span>
</span><span class='line'>      <span class="n">set_user</span>
</span><span class='line'>      <span class="n">update!</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">set_user</span>
</span><span class='line'>      <span class="n">object</span> <span class="o">=</span> <span class="n">build_resource</span>
</span><span class='line'>      <span class="n">object</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="n">user_signed_in?</span>
</span><span class='line'>      <span class="n">set_collection_ivar</span> <span class="n">object</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once you put those files in your lib directory and load them at startup your are able to simply add it in your controller. For example, I want to be able to create a product and set the current user, to apply some search, some filter/scope, reorder and paginate my results for my products.</p>

<figure class='code'><figcaption><span>app/controllers/products_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="ss">InheritedResources</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">InheritedResourcesModules</span><span class="p">:</span><span class="ss">:Order</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">InheritedResourcesModules</span><span class="p">:</span><span class="ss">:Scope</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">InheritedResourcesModules</span><span class="p">:</span><span class="ss">:Search</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">InheritedResourcesModules</span><span class="p">:</span><span class="ss">:BuildWithCurrentUser</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">InheritedResourcesModules</span><span class="p">:</span><span class="ss">:Pagination</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Done ! you have a 7 lines controller with search, all CRUD actions, paginations&hellip; and with this it&rsquo;s not so hard to maintain or test your controller ;)</p>

<p>Now I just have to create a gem or even a pull request on inherited_resources gem because copy paste between each project is not so good.</p>

<p><em>NB:</em> In practice you have also to add the function <strong>permitted_params</strong> in your controller to control which parameters you want accessible with <a href="https://github.com/rails/strong_parameters">strong_parameters</a> now included by default in Rails 4.</p>
";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:18;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:42:"Automatic loader with Ajax call on Angular";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:89:"http://microblog.anthonyestebe.com/2013-12-04/automatic-loader-with-ajax-call-on-angular/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2013-12-04T13:14:39+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:88:"http://microblog.anthonyestebe.com/2013-12-04/automatic-loader-with-ajax-call-on-angular";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:13043:"<p>I continue with Angular and today I will introduce how to display a loader when you do an ajax request. The classic method is everytime you make your request you display your loader then when you receive the answer you hide/destroy it. Well this is good but do this everytime is really boring and if you change your loader and you have to update the code to display/hide it it start to be horrible&hellip;</p>

<p>Hopefully with frameworks like Angular you can intercept your request before sending it and after receiving the response (like a before_action and after_action in Rails).</p>

<p>Everything happen with the object httpProvider and with two arrays <code>transformRequest</code> and <code>responseInterceptors</code>.</p>

<p><em>transformRequest</em> is an array which store some functions to process the params before sending them. In our case we will not use it to manage the parameters but only to have a function called before each requests.</p>

<p><em>responseInterceptors</em> is another array with a list of functions to call when the response from the server is just arrive.</p>

<p>Now we know a bit more about those functions, let&rsquo;s start to code it</p>

<!--more-->




<div>
                <figure class='code'><figcaption><span>loader.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">App = </span><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&quot;app&quot;</span><span class="p">,</span> <span class="p">[]</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># function to get the loader element </span>
</span><span class='line'><span class="nv">loader = </span><span class="nf">-&gt;</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s">&quot;loader&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># display the loader</span>
</span><span class='line'><span class="nv">start  = </span><span class="nf">-&gt;</span> <span class="nx">loader</span><span class="p">().</span><span class="nx">addClass</span> <span class="s">&quot;active&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># hide the loader</span>
</span><span class='line'><span class="nv">stop   = </span><span class="nf">-&gt;</span> <span class="nx">loader</span><span class="p">().</span><span class="nx">removeClass</span> <span class="s">&quot;active&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># configure the http provider</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">config</span> <span class="nf">($httpProvider) -&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># intercept all response</span>
</span><span class='line'>  <span class="nx">$httpProvider</span><span class="p">.</span><span class="nx">responseInterceptors</span><span class="p">.</span><span class="nx">push</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nf">(promise) -&gt;</span>
</span><span class='line'>      <span class="nx">promise</span><span class="p">.</span><span class="nx">then</span> <span class="nf">(response) -&gt;</span>
</span><span class='line'>        <span class="nx">stop</span><span class="p">()</span>
</span><span class='line'>        <span class="nx">response</span>
</span><span class='line'>      <span class="p">,</span> <span class="nf">(response) -&gt;</span>
</span><span class='line'>        <span class="nx">stop</span><span class="p">()</span>
</span><span class='line'>        <span class="nx">response</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># hack to know when a request will be send</span>
</span><span class='line'>  <span class="nx">$httpProvider</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">transformRequest</span><span class="p">.</span><span class="nx">push</span> <span class="nf">(data, headersGetter) -&gt;</span>
</span><span class='line'>    <span class="nx">start</span><span class="p">()</span>
</span><span class='line'>    <span class="nx">data</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span>loader.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">App</span><span class="p">,</span> <span class="nx">loader</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">stop</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">App</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="p">[]);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">loader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">&quot;loader&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">loader</span><span class="p">().</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">stop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">loader</span><span class="p">().</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$httpProvider</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$httpProvider</span><span class="p">.</span><span class="nx">responseInterceptors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">promise</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">stop</span><span class="p">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
</span><span class='line'>      <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">stop</span><span class="p">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">$httpProvider</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">transformRequest</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">headersGetter</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">start</span><span class="p">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>I will not talk about the first functions, I think it&rsquo;s clear enough I just use the class active to show/hide the loader, like that you can do some awesome css3 effect ;).</p>

<p>The thing to be aware is in the responseInterceptors array, functions in this array don&rsquo;t do anything except returning a function and we have to take car of what we return because Angular check the responses of those functions. When you are aware of this you can just start or stop your loader simply.</p>

<p data-height="268" data-theme-id="0" data-slug-hash="FcGov" data-user="antho1404" data-default-tab="result" class='codepen'>See the Pen <a href='http://codepen.io/antho1404/pen/FcGov'>FcGov</a> by Anthony (<a href='http://codepen.io/antho1404'>@antho1404</a>) on <a href='http://codepen.io'>CodePen</a></p>


<script async src="http://microblog.anthonyestebe.com//codepen.io/assets/embed/ei.js"></script>

";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:19;a:6:{s:4:"data";s:28:"
    
    
    
    
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:5:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:70:"Geolocalisation and address completion with Angular and Google Map API";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:117:"http://microblog.anthonyestebe.com/2013-12-03/geolocalisation-and-address-completion-with-angular-and-google-map-api/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:25:"2013-12-03T20:28:26+07:00";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:116:"http://microblog.anthonyestebe.com/2013-12-03/geolocalisation-and-address-completion-with-angular-and-google-map-api";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:35562:"<p>After few days without writting anything, I have now many ideas of things to share, mostly about Angular. So today I will speak about geolocalisation with Angular.</p>

<p>If you don&rsquo;t know, with html5 you can now easily know exactly where your user is, the navigator will send you the informations from the GPS, the IP address, the GSM network or wathever. For the developper, this is really simple, the navigator provide an API where you just have to call the function <code>getCurrentPosition</code> of <code>navigator.geolocation</code> and thats all :)</p>

<p>So today I wanted to use this API to know the position and then automatically fill the address field.</p>

<p>For that there is something interesting in Angular, is the possibility to create some services, a kind of module just to do something special like give the address of a user.</p>

<!--more-->




<div>
                <figure class='code'><figcaption><span>geolocalisation.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">App = </span><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span> <span class="s">&#39;app&#39;</span><span class="p">,</span> <span class="p">[]</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">service</span> <span class="s">&quot;Geolocation&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;$q&#39;</span><span class="p">,</span> <span class="s">&#39;$window&#39;</span><span class="p">,</span> <span class="nf">($q, $window) -&gt;</span>
</span><span class='line'>  <span class="vi">@getLocation = </span><span class="nf">-&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@getAddress = </span><span class="nf">-&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@extractAddress = </span><span class="nf">(addresses) -&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">@</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span>geolocalisation.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">App</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">App</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="p">[]);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s2">&quot;Geolocation&quot;</span><span class="p">,</span> <span class="p">[</span>
</span><span class='line'>  <span class="s1">&#39;$q&#39;</span><span class="p">,</span> <span class="s1">&#39;$window&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$q</span><span class="p">,</span> <span class="nx">$window</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">getLocation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">getAddress</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">extractAddress</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">addresses</span><span class="p">)</span> <span class="p">{};</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>Ok now our service is created. We will have to add the <a href="https://maps.googleapis.com/maps/api/js?v=3.exp&amp;sensor=false">google map api script</a> to be able to convert coordinate into address.</p>

<p>Let&rsquo;s write the first function to get the location, this function should return the coordonate of your user (latitude and longitude).</p>

<div>
                <figure class='code'><figcaption><span>geolocalisation.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="vi">@getLocation = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">deferred = </span><span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">()</span>
</span><span class='line'>  <span class="k">if</span> <span class="nx">$window</span><span class="p">.</span><span class="nx">navigator</span> <span class="o">and</span> <span class="nx">$window</span><span class="p">.</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span>
</span><span class='line'>    <span class="nx">$window</span><span class="p">.</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span> <span class="nf">(position) -&gt;</span>
</span><span class='line'>      <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span> <span class="nx">position</span><span class="p">.</span><span class="nx">coords</span>
</span><span class='line'>    <span class="p">,</span> <span class="nf">(error) -&gt;</span>
</span><span class='line'>      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span> <span class="s">&quot;Unable to get your location&quot;</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span> <span class="s">&quot;Your browser cannot access to your position&quot;</span>
</span><span class='line'>  <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span>geolocalisation.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">getLocation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">deferred</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">$window</span><span class="p">.</span><span class="nx">navigator</span> <span class="o">&amp;&amp;</span> <span class="nx">$window</span><span class="p">.</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$window</span><span class="p">.</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">position</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">position</span><span class="p">.</span><span class="nx">coords</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="s2">&quot;Unable to get your location&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="s2">&quot;Your browser cannot access to your position&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>Nothing complicated here (except perhaps the use of promise / I have to write something about this also), we just use the API from the browser with a callback in parameter to have the position and we return only the coordonates (because I just need this but you can return all).</p>

<p>Next part, the <code>getAddress</code> function.</p>

<div>
                <figure class='code'><figcaption><span>geolocalisation.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="vi">@getAddress = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nx">@geocoder</span> <span class="o">||=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Geocoder</span><span class="p">()</span>
</span><span class='line'>  <span class="nv">deferred    = </span><span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">()</span>
</span><span class='line'>  <span class="nx">@getLocation</span><span class="p">().</span><span class="nx">then</span> <span class="nf">(coords) =&gt;</span>
</span><span class='line'>    <span class="nv">latlng = </span><span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span><span class="p">,</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span>
</span><span class='line'>    <span class="nx">@geocoder</span><span class="p">.</span><span class="nx">geocode</span> <span class="nv">latLng: </span><span class="nx">latlng</span><span class="p">,</span> <span class="nf">(results, status) =&gt;</span>
</span><span class='line'>      <span class="k">if</span> <span class="nx">status</span> <span class="o">is</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">GeocoderStatus</span><span class="p">.</span><span class="nx">OK</span>
</span><span class='line'>        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span> <span class="nx">@extractAddress</span> <span class="nx">results</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span> <span class="s">&quot;cannot geocode status: </span><span class="si">#{</span><span class="nx">status</span><span class="si">}</span><span class="s">&quot;</span>
</span><span class='line'>    <span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span> <span class="s">&quot;cannot geocode&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span>geolocalisation.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">getAddress</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">deferred</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">geocoder</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">geocoder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Geocoder</span><span class="p">());</span>
</span><span class='line'>  <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">getLocation</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">coords</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">latlng</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">latlng</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span><span class="p">,</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">geocoder</span><span class="p">.</span><span class="nx">geocode</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">latLng</span><span class="o">:</span> <span class="nx">latlng</span>
</span><span class='line'>    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">status</span> <span class="o">===</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">GeocoderStatus</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">extractAddress</span><span class="p">(</span><span class="nx">results</span><span class="p">));</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="s2">&quot;cannot geocode status: &quot;</span> <span class="o">+</span> <span class="nx">status</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="s2">&quot;cannot geocode&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>Once again, nothing so hard, we instanciate a <em>google.maps.Geocoder</em> object (provided by the google map script) if needed then we call the <code>geocode</code> function with the latitude and longitude from the previous function. This will call google map API and return a list of results with many addresses. We just have to extract the address from the result if everything is ok and resolve the promise (like send a success callback).</p>

<p>Last function, the <code>extractAddress</code></p>

<div>
                <figure class='code'><figcaption><span>geolocalisation.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="vi">@extractAddress = </span><span class="nf">(addresses) -&gt;</span>
</span><span class='line'>  <span class="nv">result = </span><span class="p">{}</span>
</span><span class='line'>  <span class="k">for</span> <span class="nx">address</span> <span class="k">in</span> <span class="nx">addresses</span>
</span><span class='line'>    <span class="nx">result</span><span class="p">.</span><span class="nx">fullAddress</span> <span class="o">||=</span> <span class="nx">address</span><span class="p">.</span><span class="nx">formatted_address</span>
</span><span class='line'>    <span class="nx">result</span><span class="p">.</span><span class="nx">coord</span>       <span class="o">||=</span> <span class="p">[</span><span class="nx">address</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">ob</span><span class="p">,</span> <span class="nx">address</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pb</span><span class="p">]</span>
</span><span class='line'>    <span class="k">for</span> <span class="nx">component</span> <span class="k">in</span> <span class="nx">address</span><span class="p">.</span><span class="nx">address_components</span>
</span><span class='line'>      <span class="nx">result</span><span class="p">.</span><span class="nx">street</span>  <span class="o">||=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">long_name</span> <span class="k">if</span> <span class="nx">component</span><span class="p">.</span><span class="nx">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">is</span> <span class="s">&quot;route&quot;</span>
</span><span class='line'>      <span class="nx">result</span><span class="p">.</span><span class="nx">city</span>    <span class="o">||=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">long_name</span> <span class="k">if</span> <span class="nx">component</span><span class="p">.</span><span class="nx">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">is</span> <span class="s">&quot;locality&quot;</span>
</span><span class='line'>      <span class="nx">result</span><span class="p">.</span><span class="nx">zip</span>     <span class="o">||=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">long_name</span> <span class="k">if</span> <span class="nx">component</span><span class="p">.</span><span class="nx">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">is</span> <span class="s">&quot;postal_code&quot;</span>
</span><span class='line'>      <span class="nx">result</span><span class="p">.</span><span class="nx">country</span> <span class="o">||=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">long_name</span> <span class="k">if</span> <span class="nx">component</span><span class="p">.</span><span class="nx">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">is</span> <span class="s">&quot;country&quot;</span>
</span><span class='line'>  <span class="nx">result</span>
</span></code></pre></td></tr></table></div></figure>
                <figure class='code hide'><figcaption><span>geolocalisation.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">extractAddress</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">addresses</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">address</span><span class="p">,</span> <span class="nx">component</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">_i</span><span class="p">,</span> <span class="nx">_j</span><span class="p">,</span> <span class="nx">_len</span><span class="p">,</span> <span class="nx">_len1</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">result</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len</span> <span class="o">=</span> <span class="nx">addresses</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">_len</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">address</span> <span class="o">=</span> <span class="nx">addresses</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
</span><span class='line'>    <span class="nx">result</span><span class="p">.</span><span class="nx">fullAddress</span> <span class="o">||</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">fullAddress</span> <span class="o">=</span> <span class="nx">address</span><span class="p">.</span><span class="nx">formatted_address</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">result</span><span class="p">.</span><span class="nx">coord</span> <span class="o">||</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">coord</span> <span class="o">=</span> <span class="p">[</span><span class="nx">address</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">ob</span><span class="p">,</span> <span class="nx">address</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pb</span><span class="p">]);</span>
</span><span class='line'>    <span class="nx">_ref</span> <span class="o">=</span> <span class="nx">address</span><span class="p">.</span><span class="nx">address_components</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="nx">_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_len1</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_j</span> <span class="o">&lt;</span> <span class="nx">_len1</span><span class="p">;</span> <span class="nx">_j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">component</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="nx">_j</span><span class="p">];</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">component</span><span class="p">.</span><span class="nx">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;route&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">result</span><span class="p">.</span><span class="nx">street</span> <span class="o">||</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">street</span> <span class="o">=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">long_name</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">component</span><span class="p">.</span><span class="nx">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;locality&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">result</span><span class="p">.</span><span class="nx">city</span> <span class="o">||</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">city</span> <span class="o">=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">long_name</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">component</span><span class="p">.</span><span class="nx">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;postal_code&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">result</span><span class="p">.</span><span class="nx">zip</span> <span class="o">||</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">zip</span> <span class="o">=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">long_name</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">component</span><span class="p">.</span><span class="nx">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;country&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">result</span><span class="p">.</span><span class="nx">country</span> <span class="o">||</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">country</span> <span class="o">=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">long_name</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>
                <a href='#' class='toggle-code'>Toggle coffeescript/javascript</a>
              </div>


<p>This is an implementation of course it depends of what you need but here I just check all results and I fill the data I want when I found it in the result.</p>

<p>Now we have everything for our service so if you want to get the address of a user you just need to write 2 lines.</p>

<figure class='code'><figcaption><span>controller.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="p">...</span>
</span><span class='line'><span class="nx">Geolocation</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">().</span><span class="nx">then</span> <span class="nf">(address) -&gt;</span>
</span><span class='line'>  <span class="nv">$scope.model.address = </span><span class="nx">address</span>
</span><span class='line'><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>



";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"type";s:4:"html";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}}}}}}}s:4:"type";i:512;s:7:"headers";a:7:{s:12:"content-type";s:29:"application/xml;charset=utf-8";s:4:"date";s:29:"Sat, 21 Jun 2014 10:05:13 GMT";s:13:"last-modified";s:29:"Thu, 22 May 2014 05:52:02 GMT";s:6:"server";s:37:"WEBrick/1.3.1 (Ruby/2.0.0/2014-05-08)";s:22:"x-content-type-options";s:7:"nosniff";s:14:"content-length";s:6:"291935";s:10:"connection";s:10:"keep-alive";}s:5:"build";s:14:"20121030085402";}